;
; File generated by cc65 v 2.19 - Git c48e821c4
;
	.fopt		compiler,"cc65 v 2.19 - Git c48e821c4"
	.setcpu		"6502"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	on
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.dbg		file, "src/dungeon.c", 18548, 1639113695
	.dbg		file, "src/lib/nesdoug.h", 6692, 1638737118
	.dbg		file, "src/lib/neslib.h", 8949, 1638737118
	.dbg		file, "src/lib/unrle.h", 125, 1638737118
	.dbg		file, "src/mmc3/mmc3_code.h", 2262, 1638737118
	.dbg		file, "src/directions.h", 163, 1639105166
	.dbg		file, "src/dungeon.h", 135, 1639048020
	.dbg		file, "src/irq_buffer.h", 147, 1638737118
	.dbg		file, "src/ends_and_beginnings.h", 171, 1639112610
	.dbg		file, "src/temp.h", 613, 1638737118
	.dbg		file, "src/../assets/palettes.h", 57, 1638911019
	.dbg		file, "src/../assets/nametables.h", 252, 1639112680
	.dbg		file, "src/../assets/metatiles.h", 159, 1639019462
	.dbg		file, "src/../assets/sprites.h", 103, 1639049959
	.dbg		file, "src/../assets/dungeon.h", 168, 1639015544
	.dbg		sym, "one_vram_buffer", "00", extern, "_one_vram_buffer"
	.dbg		sym, "multi_vram_buffer_horz", "00", extern, "_multi_vram_buffer_horz"
	.dbg		sym, "clear_vram_buffer", "00", extern, "_clear_vram_buffer"
	.dbg		sym, "get_pad_new", "00", extern, "_get_pad_new"
	.dbg		sym, "get_frame_count", "00", extern, "_get_frame_count"
	.dbg		sym, "pal_fade_to", "00", extern, "_pal_fade_to"
	.dbg		sym, "set_scroll_y", "00", extern, "_set_scroll_y"
	.dbg		sym, "set_data_pointer", "00", extern, "_set_data_pointer"
	.dbg		sym, "set_mt_pointer", "00", extern, "_set_mt_pointer"
	.dbg		sym, "buffer_4_mt", "00", extern, "_buffer_4_mt"
	.dbg		sym, "flush_vram_update_nmi", "00", extern, "_flush_vram_update_nmi"
	.dbg		sym, "pal_bg", "00", extern, "_pal_bg"
	.dbg		sym, "pal_spr", "00", extern, "_pal_spr"
	.dbg		sym, "ppu_off", "00", extern, "_ppu_off"
	.dbg		sym, "ppu_on_all", "00", extern, "_ppu_on_all"
	.dbg		sym, "oam_clear", "00", extern, "_oam_clear"
	.dbg		sym, "oam_spr", "00", extern, "_oam_spr"
	.dbg		sym, "oam_meta_spr", "00", extern, "_oam_meta_spr"
	.dbg		sym, "pad_poll", "00", extern, "_pad_poll"
	.dbg		sym, "pad_state", "00", extern, "_pad_state"
	.dbg		sym, "vram_adr", "00", extern, "_vram_adr"
	.dbg		sym, "vram_unrle", "00", extern, "_vram_unrle"
	.dbg		sym, "set_unrle_buffer", "00", extern, "_set_unrle_buffer"
	.dbg		sym, "unrle_to_buffer", "00", extern, "_unrle_to_buffer"
	.dbg		sym, "set_chr_mode_0", "00", extern, "_set_chr_mode_0"
	.dbg		sym, "set_chr_mode_1", "00", extern, "_set_chr_mode_1"
	.dbg		sym, "set_chr_mode_2", "00", extern, "_set_chr_mode_2"
	.dbg		sym, "set_chr_mode_3", "00", extern, "_set_chr_mode_3"
	.dbg		sym, "set_chr_mode_4", "00", extern, "_set_chr_mode_4"
	.dbg		sym, "set_chr_mode_5", "00", extern, "_set_chr_mode_5"
	.dbg		sym, "double_buffer", "00", extern, "_double_buffer"
	.dbg		sym, "double_buffer_index", "00", extern, "_double_buffer_index"
	.dbg		sym, "go_to_bad_ending", "00", extern, "_go_to_bad_ending"
	.dbg		sym, "go_to_good_ending", "00", extern, "_go_to_good_ending"
	.dbg		sym, "pad1", "00", extern, "_pad1"
	.dbg		sym, "pad1_new", "00", extern, "_pad1_new"
	.dbg		sym, "temp", "00", extern, "_temp"
	.dbg		sym, "i", "00", extern, "_i"
	.dbg		sym, "temp_x", "00", extern, "_temp_x"
	.dbg		sym, "temp_y", "00", extern, "_temp_y"
	.dbg		sym, "temp_char", "00", extern, "_temp_char"
	.dbg		sym, "temp_int", "00", extern, "_temp_int"
	.dbg		sym, "bg_palette", "00", extern, "_bg_palette"
	.dbg		sym, "sprites_palette", "00", extern, "_sprites_palette"
	.dbg		sym, "hud_nametable", "00", extern, "_hud_nametable"
	.dbg		sym, "metatiles", "00", extern, "_metatiles"
	.dbg		sym, "metasprites_pointers", "00", extern, "_metasprites_pointers"
	.dbg		sym, "starting_room", "00", extern, "_starting_room"
	.import		_one_vram_buffer
	.import		_multi_vram_buffer_horz
	.import		_clear_vram_buffer
	.import		_get_pad_new
	.import		_get_frame_count
	.import		_pal_fade_to
	.import		_set_scroll_y
	.import		_set_data_pointer
	.import		_set_mt_pointer
	.import		_buffer_4_mt
	.import		_flush_vram_update_nmi
	.import		_pal_bg
	.import		_pal_spr
	.import		_ppu_off
	.import		_ppu_on_all
	.import		_oam_clear
	.import		_oam_spr
	.import		_oam_meta_spr
	.import		_pad_poll
	.import		_pad_state
	.import		_vram_adr
	.import		_vram_unrle
	.import		_set_unrle_buffer
	.import		_unrle_to_buffer
	.import		_set_chr_mode_0
	.import		_set_chr_mode_1
	.import		_set_chr_mode_2
	.import		_set_chr_mode_3
	.import		_set_chr_mode_4
	.import		_set_chr_mode_5
	.export		_init_dungeon
	.export		_dungeon_handler
	.export		_dungeon_draw_sprites
	.import		_double_buffer
	.importzp	_double_buffer_index
	.import		_go_to_bad_ending
	.import		_go_to_good_ending
	.importzp	_pad1
	.importzp	_pad1_new
	.importzp	_temp
	.importzp	_i
	.importzp	_temp_x
	.importzp	_temp_y
	.importzp	_temp_char
	.importzp	_temp_int
	.import		_bg_palette
	.import		_sprites_palette
	.import		_hud_nametable
	.import		_metatiles
	.import		_metasprites_pointers
	.import		_starting_room
	.export		_current_room_ptr
	.export		_up_room_ptr
	.export		_down_room_ptr
	.export		_left_room_ptr
	.export		_right_room_ptr
	.export		_entity_patrol_points
	.export		_room_buffer
	.export		_player_x
	.export		_player_y
	.export		_player_dx
	.export		_player_dy
	.export		_player_direction
	.export		_player_lives
	.export		_player_energy
	.export		_last_spawn_x
	.export		_last_spawn_y
	.export		_current_dungeon_mode
	.export		_num_entities
	.export		_entity_type
	.export		_entity_x
	.export		_entity_y
	.export		_entity_dx
	.export		_entity_dy
	.export		_entity_target_x
	.export		_entity_target_y
	.export		_entity_lives
	.export		_entity_direction
	.export		_num_entity_patrol_points
	.export		_entity_patrol_index
	.export		_shooting_cooldown
	.export		_player_fire_x
	.export		_player_fire_y
	.export		_player_fire_dx
	.export		_player_fire_dy
	.export		_player_fire_direction
	.export		_player_fire_active
	.export		_empty_row
	.export		_load_room
	.export		_refresh_hud
	.export		_damage_player
	.export		_point_room_collision
	.export		_player_room_collision
	.export		_victory
	.export		_exiting_room
	.export		_dungeon_moving_handler
	.export		_xm
	.export		_ym
	.export		_unobstructed_line
	.export		_entities_handler
	.export		_player_fire_handler

.segment	"RODATA"

.segment	"RODATA"
.segment	"RODATA"
.segment	"RODATA"
.segment	"RODATA"
_empty_row:
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00

.segment	"BSS"

.segment	"ZEROPAGE"
_current_room_ptr:
	.res	2,$00
_up_room_ptr:
	.res	2,$00
_down_room_ptr:
	.res	2,$00
_left_room_ptr:
	.res	2,$00
_right_room_ptr:
	.res	2,$00
_entity_patrol_points:
	.res	32,$00
.segment	"BSS"
_room_buffer:
	.res	240,$00
_player_x:
	.res	2,$00
_player_y:
	.res	2,$00
_player_dx:
	.res	2,$00
_player_dy:
	.res	2,$00
_player_direction:
	.res	1,$00
_player_lives:
	.res	1,$00
_player_energy:
	.res	1,$00
_last_spawn_x:
	.res	2,$00
_last_spawn_y:
	.res	2,$00
_current_dungeon_mode:
	.res	1,$00
_num_entities:
	.res	1,$00
_entity_type:
	.res	16,$00
_entity_x:
	.res	32,$00
_entity_y:
	.res	32,$00
_entity_dx:
	.res	32,$00
_entity_dy:
	.res	32,$00
_entity_target_x:
	.res	32,$00
_entity_target_y:
	.res	32,$00
_entity_lives:
	.res	16,$00
_entity_direction:
	.res	16,$00
_num_entity_patrol_points:
	.res	16,$00
_entity_patrol_index:
	.res	16,$00
_shooting_cooldown:
	.res	1,$00
_player_fire_x:
	.res	10,$00
_player_fire_y:
	.res	10,$00
_player_fire_dx:
	.res	10,$00
_player_fire_dy:
	.res	10,$00
_player_fire_direction:
	.res	5,$00
_player_fire_active:
	.res	5,$00
_xm:
	.res	1,$00
_ym:
	.res	1,$00

; ---------------------------------------------------------------
; void __near__ init_dungeon (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_init_dungeon: near

	.dbg	func, "init_dungeon", "00", extern, "_init_dungeon"

.segment	"CODE"

;
; load_room((unsigned char*) starting_room);
;
	.dbg	line, "src/dungeon.c", 100
	lda     _starting_room
	ldx     _starting_room+1
	jsr     _load_room
;
; last_spawn_x = player_x = FP(0x80, 0x00); // TODO: back to 0x30
;
	.dbg	line, "src/dungeon.c", 101
	ldx     #$20
	lda     #$00
	sta     _player_x
	stx     _player_x+1
	sta     _last_spawn_x
	stx     _last_spawn_x+1
;
; last_spawn_y = player_y = FP(0x40, 0x00);
;
	.dbg	line, "src/dungeon.c", 102
	ldx     #$10
	sta     _player_y
	stx     _player_y+1
	sta     _last_spawn_y
	stx     _last_spawn_y+1
;
; player_dx = 0x00;
;
	.dbg	line, "src/dungeon.c", 103
	sta     _player_dx
	sta     _player_dx+1
;
; player_dy = 0x00;
;
	.dbg	line, "src/dungeon.c", 104
	sta     _player_dy
	sta     _player_dy+1
;
; player_direction = Down;
;
	.dbg	line, "src/dungeon.c", 105
	lda     #$01
	sta     _player_direction
;
; player_lives = 3;
;
	.dbg	line, "src/dungeon.c", 106
	lda     #$03
	sta     _player_lives
;
; player_energy = 5;
;
	.dbg	line, "src/dungeon.c", 107
	lda     #$05
	sta     _player_energy
;
; shooting_cooldown = 0;
;
	.dbg	line, "src/dungeon.c", 108
	lda     #$00
	sta     _shooting_cooldown
;
; current_dungeon_mode = Moving;
;
	.dbg	line, "src/dungeon.c", 109
	lda     #$01
	sta     _current_dungeon_mode
;
; }
;
	.dbg	line, "src/dungeon.c", 110
	rts

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ dungeon_handler (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_dungeon_handler: near

	.dbg	func, "dungeon_handler", "00", extern, "_dungeon_handler"

.segment	"CODE"

;
; double_buffer[double_buffer_index++] = MENU_SCANLINE - 1;
;
	.dbg	line, "src/dungeon.c", 588
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	lda     #$00
	adc     #>(_double_buffer)
	sta     ptr1+1
	lda     #$BF
	ldy     #$00
	sta     (ptr1),y
;
; double_buffer[double_buffer_index++] = 0xf6;
;
	.dbg	line, "src/dungeon.c", 589
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	tya
	adc     #>(_double_buffer)
	sta     ptr1+1
	lda     #$F6
	sta     (ptr1),y
;
; double_buffer[double_buffer_index++] = 8;
;
	.dbg	line, "src/dungeon.c", 590
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	tya
	adc     #>(_double_buffer)
	sta     ptr1+1
	lda     #$08
	sta     (ptr1),y
;
; temp_int = 0x2000; // TODO: switch to dialogue
;
	.dbg	line, "src/dungeon.c", 591
	ldx     #$20
	sty     _temp_int
	stx     _temp_int+1
;
; double_buffer[double_buffer_index++] = temp_int;
;
	.dbg	line, "src/dungeon.c", 592
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	tya
	adc     #>(_double_buffer)
	sta     ptr1+1
	lda     _temp_int
	sta     (ptr1),y
;
; double_buffer[double_buffer_index++] = 0;
;
	.dbg	line, "src/dungeon.c", 593
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	tya
	adc     #>(_double_buffer)
	sta     ptr1+1
	tya
	sta     (ptr1),y
;
; double_buffer[double_buffer_index++] = ((temp_int & 0xF8) << 2);
;
	.dbg	line, "src/dungeon.c", 594
	lda     _double_buffer_index
	inc     _double_buffer_index
	clc
	adc     #<(_double_buffer)
	sta     ptr1
	tya
	adc     #>(_double_buffer)
	sta     ptr1+1
	lda     _temp_int
	and     #$F8
	asl     a
	asl     a
	sta     (ptr1),y
;
; entities_handler();
;
	.dbg	line, "src/dungeon.c", 596
	jsr     _entities_handler
;
; player_fire_handler();
;
	.dbg	line, "src/dungeon.c", 597
	jsr     _player_fire_handler
;
; if (player_lives == 0) {
;
	.dbg	line, "src/dungeon.c", 598
	ldx     #$00
	lda     _player_lives
	bne     L0006
;
; go_to_bad_ending();
;
	.dbg	line, "src/dungeon.c", 599
	jmp     _go_to_bad_ending
;
; pad_poll(0);
;
	.dbg	line, "src/dungeon.c", 603
L0006:	lda     #$00
	jsr     _pad_poll
;
; pad1 = pad_state(0);
;
	.dbg	line, "src/dungeon.c", 604
	lda     #$00
	jsr     _pad_state
	sta     _pad1
;
; pad1_new = get_pad_new(0);
;
	.dbg	line, "src/dungeon.c", 605
	lda     #$00
	jsr     _get_pad_new
	sta     _pad1_new
;
; switch(current_dungeon_mode) {
;
	.dbg	line, "src/dungeon.c", 607
	lda     _current_dungeon_mode
;
; }
;
	.dbg	line, "src/dungeon.c", 609
	cmp     #$01
	bne     L0004
;
; case Moving: dungeon_moving_handler(); break;
;
	.dbg	line, "src/dungeon.c", 608
	jmp     _dungeon_moving_handler
;
; }
;
	.dbg	line, "src/dungeon.c", 610
L0004:	rts

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ dungeon_draw_sprites (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_dungeon_draw_sprites: near

	.dbg	func, "dungeon_draw_sprites", "00", extern, "_dungeon_draw_sprites"

.segment	"CODE"

;
; temp = 2 * player_direction;
;
	.dbg	line, "src/dungeon.c", 614
	lda     _player_direction
	asl     a
	sta     _temp
;
; if (player_dx != 0 || player_dy != 0) {
;
	.dbg	line, "src/dungeon.c", 615
	lda     _player_dx
	ora     _player_dx+1
	bne     L0079
	lda     _player_dy
	ora     _player_dy+1
	beq     L0007
;
; if ((INT(player_x) ^ INT(player_y)) & 0b01000) temp++;
;
	.dbg	line, "src/dungeon.c", 616
L0079:	lda     _player_x
	ldx     _player_x+1
	jsr     asrax4
	jsr     asrax2
	sta     ptr1
	lda     _player_y
	ldx     _player_y+1
	jsr     asrax4
	jsr     asrax2
	eor     ptr1
	and     #$08
	beq     L0007
	inc     _temp
;
; oam_meta_spr(INT(player_x), INT(player_y) - 1, (const unsigned char *) metasprites_pointers[temp]);
;
	.dbg	line, "src/dungeon.c", 618
L0007:	jsr     decsp2
	lda     _player_x
	ldx     _player_x+1
	jsr     asrax4
	jsr     asrax2
	ldy     #$01
	sta     (sp),y
	lda     _player_y
	ldx     _player_y+1
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$01
	dey
	sta     (sp),y
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L005F
	inx
	clc
L005F:	adc     #<(_metasprites_pointers)
	sta     ptr1
	txa
	adc     #>(_metasprites_pointers)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     _oam_meta_spr
;
; for(i = 0; i < num_entities; i++) {
;
	.dbg	line, "src/dungeon.c", 620
	lda     #$00
	sta     _i
L007A:	lda     _i
	cmp     _num_entities
	jcs     L007C
;
; if (entity_lives[i] == 0) continue;
;
	.dbg	line, "src/dungeon.c", 621
	ldy     _i
	lda     _entity_lives,y
	jeq     L007B
;
; switch(entity_type[i]) {
;
	.dbg	line, "src/dungeon.c", 622
	ldy     _i
	lda     _entity_type,y
;
; }
;
	.dbg	line, "src/dungeon.c", 650
	beq     L0012
	cmp     #$01
	jeq     L0024
	cmp     #$02
	beq     L0014
	jmp     L007B
;
; oam_meta_spr(INT(entity_x[i]), INT(entity_y[i]) - 1, (const unsigned char *) metasprites_pointers[16]);
;
	.dbg	line, "src/dungeon.c", 624
L0012:	jsr     decsp2
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0060
	inx
	clc
L0060:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	iny
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0061
	inx
	clc
L0061:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$01
	sta     (sp),y
	lda     _metasprites_pointers+32
	ldx     _metasprites_pointers+32+1
;
; break;
;
	.dbg	line, "src/dungeon.c", 625
	jmp     L005D
;
; switch(entity_direction[i]) {
;
	.dbg	line, "src/dungeon.c", 627
L0014:	ldy     _i
	lda     _entity_direction,y
;
; }
;
	.dbg	line, "src/dungeon.c", 640
	beq     L0018
	cmp     #$01
	beq     L001B
	cmp     #$02
	jeq     L001E
	cmp     #$03
	jeq     L0021
	jmp     L007B
;
; oam_spr(INT(entity_x[i]) - 4, INT(entity_y[i]) - 5, 0x60, 0x01);
;
	.dbg	line, "src/dungeon.c", 629
L0018:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0062
	inx
	clc
L0062:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0063
	inx
	clc
L0063:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$60
	dey
	sta     (sp),y
	lda     #$01
	jsr     _oam_spr
;
; break;
;
	.dbg	line, "src/dungeon.c", 630
	jmp     L007B
;
; oam_spr(INT(entity_x[i]) - 4, INT(entity_y[i]) - 5, 0x60, 0x01 | OAM_FLIP_V);
;
	.dbg	line, "src/dungeon.c", 632
L001B:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0064
	inx
	clc
L0064:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0065
	inx
	clc
L0065:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$60
	dey
	sta     (sp),y
	lda     #$81
	jsr     _oam_spr
;
; break;
;
	.dbg	line, "src/dungeon.c", 633
	jmp     L007B
;
; oam_spr(INT(entity_x[i]) - 4, INT(entity_y[i]) - 5, 0x50, 0x01 | OAM_FLIP_H);
;
	.dbg	line, "src/dungeon.c", 635
L001E:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0066
	inx
	clc
L0066:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0067
	inx
	clc
L0067:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$50
	dey
	sta     (sp),y
	lda     #$41
	jsr     _oam_spr
;
; break;
;
	.dbg	line, "src/dungeon.c", 636
	jmp     L007B
;
; oam_spr(INT(entity_x[i]) - 4, INT(entity_y[i]) - 5, 0x50, 0x01);
;
	.dbg	line, "src/dungeon.c", 638
L0021:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0068
	inx
	clc
L0068:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0069
	inx
	clc
L0069:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$50
	dey
	sta     (sp),y
	lda     #$01
	jsr     _oam_spr
;
; break;
;
	.dbg	line, "src/dungeon.c", 639
	jmp     L007B
;
; temp = 8 + 2 * entity_direction[i];
;
	.dbg	line, "src/dungeon.c", 643
L0024:	ldy     _i
	lda     _entity_direction,y
	asl     a
	clc
	adc     #$08
	sta     _temp
;
; if (entity_dx[i] != 0 || entity_dy[i] != 0) {
;
	.dbg	line, "src/dungeon.c", 644
	ldx     #$00
	lda     _i
	asl     a
	bcc     L006A
	inx
	clc
L006A:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cpx     #$00
	bne     L0029
	cmp     #$00
	bne     L0080
	lda     _i
	asl     a
	bcc     L006B
	inx
	clc
L006B:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cpx     #$00
	bne     L0029
	cmp     #$00
	beq     L002C
;
; if ((INT(entity_x[i]) ^ INT(entity_y[i])) & 0b01000) temp++;
;
	.dbg	line, "src/dungeon.c", 645
L0029:	ldx     #$00
L0080:	lda     _i
	asl     a
	bcc     L006C
	inx
	clc
L006C:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sta     sreg
	ldx     #$00
	lda     _i
	asl     a
	bcc     L006D
	inx
	clc
L006D:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	eor     sreg
	and     #$08
	beq     L002C
	inc     _temp
;
; oam_meta_spr(INT(entity_x[i]), INT(entity_y[i]) - 1, (const unsigned char *) metasprites_pointers[temp]);
;
	.dbg	line, "src/dungeon.c", 647
L002C:	jsr     decsp2
	ldx     #$00
	lda     _i
	asl     a
	bcc     L006E
	inx
	clc
L006E:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	iny
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L006F
	inx
	clc
L006F:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$01
	sta     (sp),y
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L0070
	inx
	clc
L0070:	adc     #<(_metasprites_pointers)
	sta     ptr1
	txa
	adc     #>(_metasprites_pointers)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
L005D:	jsr     _oam_meta_spr
;
; for(i = 0; i < num_entities; i++) {
;
	.dbg	line, "src/dungeon.c", 620
L007B:	inc     _i
	jmp     L007A
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 652
L007C:	lda     #$00
	sta     _i
L007D:	lda     _i
	cmp     #$05
	bcc     L0083
;
; }
;
	.dbg	line, "src/dungeon.c", 670
	rts
;
; if (player_fire_active[i]) {
;
	.dbg	line, "src/dungeon.c", 653
L0083:	ldy     _i
	lda     _player_fire_active,y
	jeq     L007E
;
; switch(player_fire_direction[i]) {
;
	.dbg	line, "src/dungeon.c", 654
	ldy     _i
	lda     _player_fire_direction,y
;
; }
;
	.dbg	line, "src/dungeon.c", 667
	beq     L0037
	cmp     #$01
	beq     L003A
	cmp     #$02
	jeq     L003D
	cmp     #$03
	jeq     L0040
	jmp     L007E
;
; oam_spr(INT(player_fire_x[i]) - 4, INT(player_fire_y[i]) - 5, 0x60, 0x01);
;
	.dbg	line, "src/dungeon.c", 656
L0037:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0071
	inx
	clc
L0071:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0072
	inx
	clc
L0072:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$60
;
; break;
;
	.dbg	line, "src/dungeon.c", 657
	jmp     L0082
;
; oam_spr(INT(player_fire_x[i]) - 4, INT(player_fire_y[i]) - 5, 0x60, 0x01 | OAM_FLIP_V);
;
	.dbg	line, "src/dungeon.c", 659
L003A:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0073
	inx
	clc
L0073:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0074
	inx
	clc
L0074:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$60
	dey
	sta     (sp),y
	lda     #$81
;
; break;
;
	.dbg	line, "src/dungeon.c", 660
	jmp     L005E
;
; oam_spr(INT(player_fire_x[i]) - 4, INT(player_fire_y[i]) - 5, 0x50, 0x01 | OAM_FLIP_H);
;
	.dbg	line, "src/dungeon.c", 662
L003D:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0075
	inx
	clc
L0075:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0076
	inx
	clc
L0076:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$50
	dey
	sta     (sp),y
	lda     #$41
;
; break;
;
	.dbg	line, "src/dungeon.c", 663
	jmp     L005E
;
; oam_spr(INT(player_fire_x[i]) - 4, INT(player_fire_y[i]) - 5, 0x50, 0x01);
;
	.dbg	line, "src/dungeon.c", 665
L0040:	jsr     decsp3
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0077
	inx
	clc
L0077:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$04
	ldy     #$02
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0078
	inx
	clc
L0078:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	dey
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	sec
	sbc     #$05
	iny
	sta     (sp),y
	lda     #$50
L0082:	dey
	sta     (sp),y
	lda     #$01
L005E:	jsr     _oam_spr
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 652
L007E:	inc     _i
	jmp     L007D

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ load_room (unsigned char *room_ptr)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_load_room: near

	.dbg	func, "load_room", "00", extern, "_load_room"
	.dbg	sym, "room_ptr", "00", auto, 0

.segment	"CODE"

;
; void load_room(unsigned char *room_ptr) {
;
	.dbg	line, "src/dungeon.c", 112
	jsr     pushax
;
; current_room_ptr = room_ptr;
;
	.dbg	line, "src/dungeon.c", 113
	ldy     #$01
	lda     (sp),y
	sta     _current_room_ptr+1
	dey
	lda     (sp),y
	sta     _current_room_ptr
;
; up_room_ptr = *(unsigned char **) room_ptr;
;
	.dbg	line, "src/dungeon.c", 115
	iny
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	iny
	lda     (ptr1),y
	sta     _up_room_ptr+1
	dey
	lda     (ptr1),y
	sta     _up_room_ptr
;
; room_ptr += 2;
;
	.dbg	line, "src/dungeon.c", 116
	ldx     #$00
	lda     #$02
	jsr     addeq0sp
;
; down_room_ptr = *(unsigned char **) room_ptr;
;
	.dbg	line, "src/dungeon.c", 117
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	iny
	lda     (ptr1),y
	sta     _down_room_ptr+1
	dey
	lda     (ptr1),y
	sta     _down_room_ptr
;
; room_ptr += 2;
;
	.dbg	line, "src/dungeon.c", 118
	ldx     #$00
	lda     #$02
	jsr     addeq0sp
;
; left_room_ptr = *(unsigned char **) room_ptr;
;
	.dbg	line, "src/dungeon.c", 119
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	iny
	lda     (ptr1),y
	sta     _left_room_ptr+1
	dey
	lda     (ptr1),y
	sta     _left_room_ptr
;
; room_ptr += 2;
;
	.dbg	line, "src/dungeon.c", 120
	ldx     #$00
	lda     #$02
	jsr     addeq0sp
;
; right_room_ptr = *(unsigned char **) room_ptr;
;
	.dbg	line, "src/dungeon.c", 121
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	iny
	lda     (ptr1),y
	sta     _right_room_ptr+1
	dey
	lda     (ptr1),y
	sta     _right_room_ptr
;
; room_ptr += 2;
;
	.dbg	line, "src/dungeon.c", 122
	ldx     #$00
	lda     #$02
	jsr     addeq0sp
;
; num_entities = *room_ptr; ++room_ptr;
;
	.dbg	line, "src/dungeon.c", 124
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	lda     (ptr1),y
	sta     _num_entities
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
;
; for(i = 0; i < num_entities; ++i) {
;
	.dbg	line, "src/dungeon.c", 125
	lda     #$00
	sta     _i
L0034:	lda     _i
	cmp     _num_entities
	jcs     L0003
;
; entity_type[i] = *room_ptr; ++room_ptr;
;
	.dbg	line, "src/dungeon.c", 126
	lda     #<(_entity_type)
	ldx     #>(_entity_type)
	clc
	adc     _i
	bcc     L0006
	inx
L0006:	sta     sreg
	stx     sreg+1
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	lda     (ptr1),y
	sta     (sreg),y
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
;
; entity_x[i] = entity_target_x[i] = FP(*room_ptr, 0x00), ++room_ptr;
;
	.dbg	line, "src/dungeon.c", 127
	ldx     #$00
	lda     _i
	asl     a
	bcc     L002D
	inx
	clc
L002D:	adc     #<(_entity_x)
	tay
	txa
	adc     #>(_entity_x)
	tax
	tya
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L002E
	inx
	clc
L002E:	adc     #<(_entity_target_x)
	tay
	txa
	adc     #>(_entity_target_x)
	tax
	tya
	jsr     pushax
	ldy     #$05
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	ldy     #$00
	ldx     #$00
	lda     (ptr1),y
	jsr     aslax4
	jsr     aslax2
	jsr     staxspidx
	jsr     staxspidx
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
;
; entity_y[i] = entity_target_y[i] = FP(*room_ptr, 0x00), ++room_ptr;
;
	.dbg	line, "src/dungeon.c", 128
	ldx     #$00
	lda     _i
	asl     a
	bcc     L002F
	inx
	clc
L002F:	adc     #<(_entity_y)
	tay
	txa
	adc     #>(_entity_y)
	tax
	tya
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0030
	inx
	clc
L0030:	adc     #<(_entity_target_y)
	tay
	txa
	adc     #>(_entity_target_y)
	tax
	tya
	jsr     pushax
	ldy     #$05
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	ldy     #$00
	ldx     #$00
	lda     (ptr1),y
	jsr     aslax4
	jsr     aslax2
	jsr     staxspidx
	jsr     staxspidx
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
;
; entity_dx[i] = entity_dy[i] = entity_direction[i] = entity_patrol_index[i] = 0;
;
	.dbg	line, "src/dungeon.c", 129
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0031
	inx
	clc
L0031:	adc     #<(_entity_dx)
	tay
	txa
	adc     #>(_entity_dx)
	tax
	tya
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0032
	inx
	clc
L0032:	adc     #<(_entity_dy)
	tay
	txa
	adc     #>(_entity_dy)
	tax
	tya
	jsr     pushax
	lda     #<(_entity_direction)
	ldx     #>(_entity_direction)
	clc
	adc     _i
	bcc     L0007
	inx
L0007:	sta     ptr1
	stx     ptr1+1
	ldy     _i
	ldx     #$00
	txa
	sta     _entity_patrol_index,y
	tay
	sta     (ptr1),y
	jsr     staxspidx
	jsr     staxspidx
;
; switch(entity_type[i]) {
;
	.dbg	line, "src/dungeon.c", 131
	ldy     _i
	lda     _entity_type,y
;
; }
;
	.dbg	line, "src/dungeon.c", 141
	beq     L000C
	cmp     #$01
	beq     L000E
	jmp     L0036
;
; entity_lives[i] = 0xff;
;
	.dbg	line, "src/dungeon.c", 133
L000C:	ldy     _i
	lda     #$FF
	sta     _entity_lives,y
;
; break;
;
	.dbg	line, "src/dungeon.c", 134
	jmp     L0036
;
; entity_lives[i] = 0x01;
;
	.dbg	line, "src/dungeon.c", 136
L000E:	ldy     _i
	sta     _entity_lives,y
;
; temp = num_entity_patrol_points[i] = *room_ptr; ++room_ptr;
;
	.dbg	line, "src/dungeon.c", 137
	lda     #<(_num_entity_patrol_points)
	ldx     #>(_num_entity_patrol_points)
	clc
	adc     _i
	bcc     L0010
	inx
L0010:	sta     sreg
	stx     sreg+1
	ldy     #$01
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	lda     (ptr1),y
	sta     (sreg),y
	sta     _temp
	ldx     #$00
	lda     #$01
	jsr     addeq0sp
;
; entity_patrol_points[i] = (patrol_coordinates_t(*)[]) room_ptr;
;
	.dbg	line, "src/dungeon.c", 138
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0033
	inx
	clc
L0033:	adc     #<(_entity_patrol_points)
	sta     ptr1
	txa
	adc     #>(_entity_patrol_points)
	sta     ptr1+1
	ldy     #$01
	lda     (sp),y
	tax
	dey
	lda     (sp),y
	sta     (ptr1),y
	iny
	txa
	sta     (ptr1),y
;
; room_ptr += (2 * temp);
;
	.dbg	line, "src/dungeon.c", 139
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L0035
	inx
L0035:	jsr     addeq0sp
;
; for(i = 0; i < num_entities; ++i) {
;
	.dbg	line, "src/dungeon.c", 125
L0036:	inc     _i
	jmp     L0034
;
; set_unrle_buffer((unsigned char *) room_buffer);
;
	.dbg	line, "src/dungeon.c", 144
L0003:	lda     #<(_room_buffer)
	ldx     #>(_room_buffer)
	jsr     _set_unrle_buffer
;
; unrle_to_buffer(room_ptr);
;
	.dbg	line, "src/dungeon.c", 145
	ldy     #$01
	lda     (sp),y
	tax
	dey
	lda     (sp),y
	jsr     _unrle_to_buffer
;
; pal_fade_to(4, 0);
;
	.dbg	line, "src/dungeon.c", 147
	lda     #$04
	jsr     pusha
	lda     #$00
	jsr     _pal_fade_to
;
; ppu_off();
;
	.dbg	line, "src/dungeon.c", 148
	jsr     _ppu_off
;
; pal_bg(bg_palette);
;
	.dbg	line, "src/dungeon.c", 150
	lda     #<(_bg_palette)
	ldx     #>(_bg_palette)
	jsr     _pal_bg
;
; pal_spr(sprites_palette);
;
	.dbg	line, "src/dungeon.c", 151
	lda     #<(_sprites_palette)
	ldx     #>(_sprites_palette)
	jsr     _pal_spr
;
; vram_adr(NTADR_C(0,0));
;
	.dbg	line, "src/dungeon.c", 154
	ldx     #$28
	lda     #$00
	jsr     _vram_adr
;
; vram_unrle(hud_nametable);
;
	.dbg	line, "src/dungeon.c", 155
	lda     #<(_hud_nametable)
	ldx     #>(_hud_nametable)
	jsr     _vram_unrle
;
; vram_adr(NTADR_A(0,0));
;
	.dbg	line, "src/dungeon.c", 156
	ldx     #$20
	lda     #$00
	jsr     _vram_adr
;
; set_mt_pointer(metatiles);
;
	.dbg	line, "src/dungeon.c", 158
	lda     #<(_metatiles)
	ldx     #>(_metatiles)
	jsr     _set_mt_pointer
;
; set_data_pointer(room_buffer);
;
	.dbg	line, "src/dungeon.c", 159
	lda     #<(_room_buffer)
	ldx     #>(_room_buffer)
	jsr     _set_data_pointer
;
; temp_int = 0x2000;
;
	.dbg	line, "src/dungeon.c", 161
	ldx     #$20
	lda     #$00
	sta     _temp_int
	stx     _temp_int+1
;
; temp = 0;
;
	.dbg	line, "src/dungeon.c", 162
	sta     _temp
;
; for(temp_y = 0; temp_y < 12; temp_y+=2) {
;
	.dbg	line, "src/dungeon.c", 163
L002C:	sta     _temp_y
	cmp     #$0C
	bcs     L0038
;
; for(temp_x = 0; temp_x < 16; temp_x+=2) {
;
	.dbg	line, "src/dungeon.c", 164
	lda     #$00
L002B:	sta     _temp_x
	cmp     #$10
	bcs     L0037
;
; temp_int = 0x2000 + 2 * temp_x + 0x40 * temp_y;
;
	.dbg	line, "src/dungeon.c", 165
	ldx     #$00
	lda     _temp_x
	asl     a
	bcc     L002A
	inx
L002A:	sta     ptr1
	txa
	clc
	adc     #$20
	sta     ptr1+1
	ldx     #$00
	lda     _temp_y
	jsr     shlax4
	jsr     shlax2
	clc
	adc     ptr1
	pha
	txa
	adc     ptr1+1
	tax
	pla
	sta     _temp_int
	stx     _temp_int+1
;
; buffer_4_mt(temp_int, (temp_y << 4) | temp_x);
;
	.dbg	line, "src/dungeon.c", 166
	jsr     pushax
	lda     _temp_y
	asl     a
	asl     a
	asl     a
	asl     a
	sta     ptr1
	lda     _temp_x
	ora     ptr1
	jsr     _buffer_4_mt
;
; flush_vram_update_nmi();
;
	.dbg	line, "src/dungeon.c", 167
	jsr     _flush_vram_update_nmi
;
; clear_vram_buffer();
;
	.dbg	line, "src/dungeon.c", 168
	jsr     _clear_vram_buffer
;
; for(temp_x = 0; temp_x < 16; temp_x+=2) {
;
	.dbg	line, "src/dungeon.c", 164
	lda     #$02
	clc
	adc     _temp_x
	jmp     L002B
;
; for(temp_y = 0; temp_y < 12; temp_y+=2) {
;
	.dbg	line, "src/dungeon.c", 163
L0037:	lda     #$02
	clc
	adc     _temp_y
	jmp     L002C
;
; for(temp_y = 24; temp_y < 30; temp_y++) {
;
	.dbg	line, "src/dungeon.c", 172
L0038:	lda     #$18
	sta     _temp_y
L0039:	lda     _temp_y
	cmp     #$1E
	bcs     L003A
;
; multi_vram_buffer_horz(empty_row, 32, NTADR_A(0, temp_y));
;
	.dbg	line, "src/dungeon.c", 173
	jsr     decsp3
	lda     #<(_empty_row)
	ldy     #$01
	sta     (sp),y
	iny
	lda     #>(_empty_row)
	sta     (sp),y
	lda     #$20
	ldy     #$00
	sta     (sp),y
	ldx     #$00
	lda     _temp_y
	jsr     aslax4
	stx     tmp1
	asl     a
	rol     tmp1
	pha
	lda     tmp1
	ora     #$20
	tax
	pla
	jsr     _multi_vram_buffer_horz
;
; flush_vram_update_nmi();
;
	.dbg	line, "src/dungeon.c", 174
	jsr     _flush_vram_update_nmi
;
; clear_vram_buffer();
;
	.dbg	line, "src/dungeon.c", 175
	jsr     _clear_vram_buffer
;
; for(temp_y = 24; temp_y < 30; temp_y++) {
;
	.dbg	line, "src/dungeon.c", 172
	inc     _temp_y
	jmp     L0039
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 178
L003A:	lda     #$00
	sta     _i
L003B:	lda     _i
	cmp     #$05
	bcs     L003C
;
; player_fire_active[i] = 0;
;
	.dbg	line, "src/dungeon.c", 179
	ldy     _i
	lda     #$00
	sta     _player_fire_active,y
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 178
	inc     _i
	jmp     L003B
;
; set_chr_mode_2(BG_MAIN_0);
;
	.dbg	line, "src/dungeon.c", 182
L003C:	lda     #$00
	jsr     _set_chr_mode_2
;
; set_chr_mode_3(BG_MAIN_1);
;
	.dbg	line, "src/dungeon.c", 183
	lda     #$01
	jsr     _set_chr_mode_3
;
; set_chr_mode_4(BG_MAIN_2);
;
	.dbg	line, "src/dungeon.c", 184
	lda     #$02
	jsr     _set_chr_mode_4
;
; set_chr_mode_5(BG_MAIN_3);
;
	.dbg	line, "src/dungeon.c", 185
	lda     #$03
	jsr     _set_chr_mode_5
;
; set_chr_mode_0(SPRITE_0);
;
	.dbg	line, "src/dungeon.c", 186
	lda     #$04
	jsr     _set_chr_mode_0
;
; set_chr_mode_1(SPRITE_1);
;
	.dbg	line, "src/dungeon.c", 187
	lda     #$06
	jsr     _set_chr_mode_1
;
; oam_clear();
;
	.dbg	line, "src/dungeon.c", 188
	jsr     _oam_clear
;
; dungeon_draw_sprites();
;
	.dbg	line, "src/dungeon.c", 189
	jsr     _dungeon_draw_sprites
;
; refresh_hud();
;
	.dbg	line, "src/dungeon.c", 190
	jsr     _refresh_hud
;
; ppu_on_all();
;
	.dbg	line, "src/dungeon.c", 191
	jsr     _ppu_on_all
;
; set_scroll_y(0);
;
	.dbg	line, "src/dungeon.c", 192
	ldx     #$00
	txa
	jsr     _set_scroll_y
;
; pal_fade_to(0, 4);
;
	.dbg	line, "src/dungeon.c", 193
	lda     #$00
	jsr     pusha
	lda     #$04
	jsr     _pal_fade_to
;
; }
;
	.dbg	line, "src/dungeon.c", 194
	jmp     incsp2

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ refresh_hud (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_refresh_hud: near

	.dbg	func, "refresh_hud", "00", extern, "_refresh_hud"

.segment	"CODE"

;
; for(i = 0; i < 3; i++) {
;
	.dbg	line, "src/dungeon.c", 197
	lda     #$00
	sta     _i
L0014:	lda     _i
	cmp     #$03
	bcs     L0016
;
; if (i < player_lives) {
;
	.dbg	line, "src/dungeon.c", 198
	cmp     _player_lives
	bcs     L0015
;
; one_vram_buffer(0x04, NTADR_C(8 + i, 1));
;
	.dbg	line, "src/dungeon.c", 199
	lda     #$04
;
; } else {
;
	.dbg	line, "src/dungeon.c", 200
	jmp     L002F
;
; one_vram_buffer(0x00, NTADR_C(8 + i, 1));
;
	.dbg	line, "src/dungeon.c", 201
L0015:	lda     #$00
L002F:	jsr     pusha
	ldx     #$00
	lda     _i
	clc
	adc     #$08
	bcc     L0009
	inx
L0009:	ora     #$20
	pha
	txa
	ora     #$28
	tax
	pla
	jsr     _one_vram_buffer
;
; for(i = 0; i < 3; i++) {
;
	.dbg	line, "src/dungeon.c", 197
	inc     _i
	jmp     L0014
;
; for(i = 0; i < 5; i++) {
;
	.dbg	line, "src/dungeon.c", 204
L0016:	lda     #$00
	sta     _i
L0017:	lda     _i
	cmp     #$05
	bcs     L000B
;
; if (i < player_energy) {
;
	.dbg	line, "src/dungeon.c", 205
	cmp     _player_energy
	bcs     L0018
;
; one_vram_buffer(0x05, NTADR_C(8 + i, 2));
;
	.dbg	line, "src/dungeon.c", 206
	lda     #$05
;
; } else {
;
	.dbg	line, "src/dungeon.c", 207
	jmp     L0030
;
; one_vram_buffer(0x00, NTADR_C(8 + i, 2));
;
	.dbg	line, "src/dungeon.c", 208
L0018:	lda     #$00
L0030:	jsr     pusha
	ldx     #$00
	lda     _i
	clc
	adc     #$08
	bcc     L0011
	inx
L0011:	ora     #$40
	pha
	txa
	ora     #$28
	tax
	pla
	jsr     _one_vram_buffer
;
; for(i = 0; i < 5; i++) {
;
	.dbg	line, "src/dungeon.c", 204
	inc     _i
	jmp     L0017
;
; }
;
	.dbg	line, "src/dungeon.c", 211
L000B:	rts

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ damage_player (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_damage_player: near

	.dbg	func, "damage_player", "00", extern, "_damage_player"

.segment	"CODE"

;
; --player_lives;
;
	.dbg	line, "src/dungeon.c", 214
	dec     _player_lives
;
; refresh_hud();
;
	.dbg	line, "src/dungeon.c", 215
	jsr     _refresh_hud
;
; player_x = last_spawn_x;
;
	.dbg	line, "src/dungeon.c", 216
	lda     _last_spawn_x+1
	sta     _player_x+1
	lda     _last_spawn_x
	sta     _player_x
;
; player_y = last_spawn_y;
;
	.dbg	line, "src/dungeon.c", 217
	lda     _last_spawn_y+1
	sta     _player_y+1
	lda     _last_spawn_y
	sta     _player_y
;
; load_room(current_room_ptr);
;
	.dbg	line, "src/dungeon.c", 218
	lda     _current_room_ptr
	ldx     _current_room_ptr+1
	jmp     _load_room

	.dbg	line
.endproc

; ---------------------------------------------------------------
; unsigned char __near__ point_room_collision (unsigned char x, unsigned char y)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_point_room_collision: near

	.dbg	func, "point_room_collision", "00", extern, "_point_room_collision"
	.dbg	sym, "x", "00", auto, 1
	.dbg	sym, "y", "00", auto, 0

.segment	"CODE"

;
; unsigned char point_room_collision(unsigned char x, unsigned char y) {
;
	.dbg	line, "src/dungeon.c", 221
	jsr     pusha
;
; temp_char = room_buffer[(y & 0xf0) | (x >> 4)];
;
	.dbg	line, "src/dungeon.c", 222
	ldy     #$00
	lda     (sp),y
	and     #$F0
	sta     ptr1
	iny
	lda     (sp),y
	lsr     a
	lsr     a
	lsr     a
	lsr     a
	ora     ptr1
	sta     ptr1
	clc
	lda     #>(_room_buffer)
	sta     ptr1+1
	ldy     #<(_room_buffer)
	lda     (ptr1),y
	sta     _temp_char
;
; return (temp_char != 0);
;
	.dbg	line, "src/dungeon.c", 224
	lda     _temp_char
	jsr     boolne
;
; }
;
	.dbg	line, "src/dungeon.c", 225
	jmp     incsp2

	.dbg	line
.endproc

; ---------------------------------------------------------------
; unsigned char __near__ player_room_collision (unsigned char x, unsigned char y)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_player_room_collision: near

	.dbg	func, "player_room_collision", "00", extern, "_player_room_collision"
	.dbg	sym, "x", "00", auto, 1
	.dbg	sym, "y", "00", auto, 0

.segment	"CODE"

;
; unsigned char player_room_collision(unsigned char x, unsigned char y) {
;
	.dbg	line, "src/dungeon.c", 227
	jsr     pusha
;
; return point_room_collision(x, y + 8) ||
;
	.dbg	line, "src/dungeon.c", 228
	ldy     #$01
	lda     (sp),y
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$08
	jsr     _point_room_collision
	tax
	bne     L0003
;
; point_room_collision(x + 15, y + 8) ||
;
	.dbg	line, "src/dungeon.c", 229
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$0F
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$08
	jsr     _point_room_collision
	tax
	bne     L0003
;
; point_room_collision(x, y + 15) ||
;
	.dbg	line, "src/dungeon.c", 230
	ldy     #$01
	lda     (sp),y
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$0F
	jsr     _point_room_collision
	tax
	bne     L0003
;
; point_room_collision(x + 15, y + 15);
;
	.dbg	line, "src/dungeon.c", 231
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$0F
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$0F
	jsr     _point_room_collision
	tax
	beq     L000A
L0003:	lda     #$01
	ldx     #$00
;
; }
;
	.dbg	line, "src/dungeon.c", 232
L000A:	jmp     incsp2

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ victory (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_victory: near

	.dbg	func, "victory", "00", extern, "_victory"

.segment	"CODE"

;
; go_to_good_ending();
;
	.dbg	line, "src/dungeon.c", 236
	jmp     _go_to_good_ending

	.dbg	line
.endproc

; ---------------------------------------------------------------
; unsigned char __near__ exiting_room (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_exiting_room: near

	.dbg	func, "exiting_room", "00", extern, "_exiting_room"

.segment	"CODE"

;
; temp_x = INT(player_x);
;
	.dbg	line, "src/dungeon.c", 240
	lda     _player_x
	ldx     _player_x+1
	jsr     asrax4
	jsr     asrax2
	sta     _temp_x
;
; temp_y = INT(player_y);
;
	.dbg	line, "src/dungeon.c", 241
	lda     _player_y
	ldx     _player_y+1
	jsr     asrax4
	jsr     asrax2
	sta     _temp_y
;
; if (temp_y < 0x08) {
;
	.dbg	line, "src/dungeon.c", 242
	cmp     #$08
	bcs     L0012
;
; last_spawn_x = player_x;
;
	.dbg	line, "src/dungeon.c", 243
	lda     _player_x+1
	sta     _last_spawn_x+1
	lda     _player_x
	sta     _last_spawn_x
;
; last_spawn_y = player_y = FP(0xa0, 0x80);
;
	.dbg	line, "src/dungeon.c", 244
	ldx     #$28
	lda     #$20
	sta     _player_y
	stx     _player_y+1
	sta     _last_spawn_y
	stx     _last_spawn_y+1
;
; if (up_room_ptr == 0) victory();
;
	.dbg	line, "src/dungeon.c", 245
	lda     _up_room_ptr
	ora     _up_room_ptr+1
	bne     L0003
	jsr     _victory
;
; else load_room(up_room_ptr);
;
	.dbg	line, "src/dungeon.c", 246
	jmp     L0005
L0003:	lda     _up_room_ptr
	ldx     _up_room_ptr+1
	jsr     _load_room
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 247
L0005:	ldx     #$00
	lda     #$01
	rts
;
; if (temp_y >= 0xa8) {
;
	.dbg	line, "src/dungeon.c", 250
L0012:	lda     _temp_y
	cmp     #$A8
	bcc     L0013
;
; last_spawn_x = player_x;
;
	.dbg	line, "src/dungeon.c", 251
	lda     _player_x+1
	sta     _last_spawn_x+1
	lda     _player_x
	sta     _last_spawn_x
;
; last_spawn_y = player_y = FP(0x08, 0x80);
;
	.dbg	line, "src/dungeon.c", 252
	ldx     #$02
	lda     #$20
	sta     _player_y
	stx     _player_y+1
	sta     _last_spawn_y
	stx     _last_spawn_y+1
;
; if (down_room_ptr == 0) victory();
;
	.dbg	line, "src/dungeon.c", 253
	lda     _down_room_ptr
	ora     _down_room_ptr+1
	bne     L0007
	jsr     _victory
;
; else load_room(down_room_ptr);
;
	.dbg	line, "src/dungeon.c", 254
	jmp     L0009
L0007:	lda     _down_room_ptr
	ldx     _down_room_ptr+1
	jsr     _load_room
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 255
L0009:	ldx     #$00
	lda     #$01
	rts
;
; if (temp_x < 0x08) {
;
	.dbg	line, "src/dungeon.c", 258
L0013:	lda     _temp_x
	cmp     #$08
	bcs     L0014
;
; last_spawn_x = player_x = FP(0xef, 0x80);
;
	.dbg	line, "src/dungeon.c", 259
	ldx     #$3B
	lda     #$E0
	sta     _player_x
	stx     _player_x+1
	sta     _last_spawn_x
	stx     _last_spawn_x+1
;
; last_spawn_y = player_y;
;
	.dbg	line, "src/dungeon.c", 260
	lda     _player_y+1
	sta     _last_spawn_y+1
	lda     _player_y
	sta     _last_spawn_y
;
; if (left_room_ptr == 0) victory();
;
	.dbg	line, "src/dungeon.c", 261
	lda     _left_room_ptr
	ora     _left_room_ptr+1
	bne     L000B
	jsr     _victory
;
; else load_room(left_room_ptr);
;
	.dbg	line, "src/dungeon.c", 262
	jmp     L000D
L000B:	lda     _left_room_ptr
	ldx     _left_room_ptr+1
	jsr     _load_room
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 263
L000D:	ldx     #$00
	lda     #$01
	rts
;
; if (temp_x >= 0xf0) {
;
	.dbg	line, "src/dungeon.c", 266
L0014:	lda     _temp_x
	cmp     #$F0
	lda     #$00
	tax
	bcc     L0016
;
; last_spawn_x = player_x = FP(0x08, 0x80);
;
	.dbg	line, "src/dungeon.c", 267
	ldx     #$02
	lda     #$20
	sta     _player_x
	stx     _player_x+1
	sta     _last_spawn_x
	stx     _last_spawn_x+1
;
; last_spawn_y = player_y;
;
	.dbg	line, "src/dungeon.c", 268
	lda     _player_y+1
	sta     _last_spawn_y+1
	lda     _player_y
	sta     _last_spawn_y
;
; if (right_room_ptr == 0) victory();
;
	.dbg	line, "src/dungeon.c", 269
	lda     _right_room_ptr
	ora     _right_room_ptr+1
	bne     L000F
	jsr     _victory
;
; else load_room(right_room_ptr);
;
	.dbg	line, "src/dungeon.c", 270
	jmp     L0011
L000F:	lda     _right_room_ptr
	ldx     _right_room_ptr+1
	jsr     _load_room
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 271
L0011:	ldx     #$00
	lda     #$01
	rts
;
; }
;
	.dbg	line, "src/dungeon.c", 275
L0016:	rts

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ dungeon_moving_handler (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_dungeon_moving_handler: near

	.dbg	func, "dungeon_moving_handler", "00", extern, "_dungeon_moving_handler"

.segment	"CODE"

;
; if (pad1 & PAD_UP) {
;
	.dbg	line, "src/dungeon.c", 278
	lda     _pad1
	and     #$08
	beq     L004D
;
; player_dx = 0;
;
	.dbg	line, "src/dungeon.c", 279
	lda     #$00
	sta     _player_dx
	sta     _player_dx+1
;
; player_dy -= ACCELERATION;
;
	.dbg	line, "src/dungeon.c", 280
	lda     _player_dy
	sec
	sbc     #$08
	sta     _player_dy
	bcs     L0003
	dec     _player_dy+1
;
; player_direction = Up;
;
	.dbg	line, "src/dungeon.c", 281
L0003:	lda     #$00
	sta     _player_direction
;
; if (player_dy < -MAX_SPEED) {
;
	.dbg	line, "src/dungeon.c", 282
	lda     _player_dy
	cmp     #$B8
	lda     _player_dy+1
	sbc     #$FF
	bvc     L0005
	eor     #$80
L0005:	bpl     L004D
;
; player_dy = -MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 283
	ldx     #$FF
	lda     #$B8
	sta     _player_dy
	stx     _player_dy+1
;
; if (pad1 & PAD_DOWN) {
;
	.dbg	line, "src/dungeon.c", 286
L004D:	lda     _pad1
	and     #$04
	beq     L004E
;
; player_dx = 0;
;
	.dbg	line, "src/dungeon.c", 287
	lda     #$00
	sta     _player_dx
	sta     _player_dx+1
;
; player_direction = Down;
;
	.dbg	line, "src/dungeon.c", 288
	lda     #$01
	sta     _player_direction
;
; player_dy += ACCELERATION;
;
	.dbg	line, "src/dungeon.c", 289
	lda     #$08
	clc
	adc     _player_dy
	sta     _player_dy
	bcc     L0007
	inc     _player_dy+1
;
; if (player_dy > MAX_SPEED) {
;
	.dbg	line, "src/dungeon.c", 290
L0007:	lda     _player_dy
	cmp     #$49
	lda     _player_dy+1
	sbc     #$00
	bvs     L0009
	eor     #$80
L0009:	bpl     L004E
;
; player_dy = MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 291
	ldx     #$00
	lda     #$48
	sta     _player_dy
	stx     _player_dy+1
;
; if (pad1 & PAD_LEFT) {
;
	.dbg	line, "src/dungeon.c", 294
L004E:	lda     _pad1
	and     #$02
	beq     L004F
;
; player_dy = 0;
;
	.dbg	line, "src/dungeon.c", 295
	lda     #$00
	sta     _player_dy
	sta     _player_dy+1
;
; player_dx -= ACCELERATION;
;
	.dbg	line, "src/dungeon.c", 296
	lda     _player_dx
	sec
	sbc     #$08
	sta     _player_dx
	bcs     L000B
	dec     _player_dx+1
;
; player_direction = Left;
;
	.dbg	line, "src/dungeon.c", 297
L000B:	lda     #$02
	sta     _player_direction
;
; if (player_dx < -MAX_SPEED) {
;
	.dbg	line, "src/dungeon.c", 298
	lda     _player_dx
	cmp     #$B8
	lda     _player_dx+1
	sbc     #$FF
	bvc     L000D
	eor     #$80
L000D:	bpl     L004F
;
; player_dx = -MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 299
	ldx     #$FF
	lda     #$B8
	sta     _player_dx
	stx     _player_dx+1
;
; if (pad1 & PAD_RIGHT) {
;
	.dbg	line, "src/dungeon.c", 302
L004F:	lda     _pad1
	and     #$01
	beq     L0050
;
; player_dy = 0;
;
	.dbg	line, "src/dungeon.c", 303
	lda     #$00
	sta     _player_dy
	sta     _player_dy+1
;
; player_direction = Right;
;
	.dbg	line, "src/dungeon.c", 304
	lda     #$03
	sta     _player_direction
;
; player_dx += ACCELERATION;
;
	.dbg	line, "src/dungeon.c", 305
	lda     #$08
	clc
	adc     _player_dx
	sta     _player_dx
	bcc     L000F
	inc     _player_dx+1
;
; if (player_dx > MAX_SPEED) {
;
	.dbg	line, "src/dungeon.c", 306
L000F:	lda     _player_dx
	cmp     #$49
	lda     _player_dx+1
	sbc     #$00
	bvs     L0011
	eor     #$80
L0011:	bpl     L0050
;
; player_dx = MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 307
	ldx     #$00
	lda     #$48
	sta     _player_dx
	stx     _player_dx+1
;
; if (pad1_new & PAD_A) {
;
	.dbg	line, "src/dungeon.c", 310
L0050:	lda     _pad1_new
	and     #$80
	jeq     L0013
;
; if (player_energy > 0 && num_entities < MAX_ENTITIES) {
;
	.dbg	line, "src/dungeon.c", 311
	lda     _player_energy
	jeq     L0013
	lda     _num_entities
	cmp     #$10
	jcs     L0013
;
; --player_energy;
;
	.dbg	line, "src/dungeon.c", 312
	dec     _player_energy
;
; refresh_hud();
;
	.dbg	line, "src/dungeon.c", 313
	jsr     _refresh_hud
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 315
	lda     #$00
	sta     _i
	tax
L0054:	lda     _i
	cmp     #$05
	bcs     L0055
;
; if (!player_fire_active[i]) break;
;
	.dbg	line, "src/dungeon.c", 316
	ldy     _i
	lda     _player_fire_active,y
	beq     L0055
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 315
	inc     _i
	jmp     L0054
;
; if (i == MAX_PLAYER_FIRE) i = 0;
;
	.dbg	line, "src/dungeon.c", 318
L0055:	lda     _i
	cmp     #$05
	bne     L0056
	lda     #$00
	sta     _i
;
; player_fire_x[i] = player_x + player_dx + FP(0x08, 0x00);
;
	.dbg	line, "src/dungeon.c", 319
L0056:	lda     _i
	asl     a
	bcc     L0043
	ldx     #$01
	clc
L0043:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	lda     _player_x
	clc
	adc     _player_dx
	pha
	lda     _player_x+1
	adc     _player_dx+1
	tax
	pla
	inx
	inx
	ldy     #$00
	sta     (ptr1),y
	iny
	txa
	sta     (ptr1),y
;
; player_fire_y[i] = player_y + player_dy + FP(0x08, 0x00);
;
	.dbg	line, "src/dungeon.c", 320
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0044
	inx
	clc
L0044:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	lda     _player_y
	clc
	adc     _player_dy
	pha
	lda     _player_y+1
	adc     _player_dy+1
	tax
	pla
	inx
	inx
	dey
	sta     (ptr1),y
	iny
	txa
	sta     (ptr1),y
;
; switch(player_direction) {
;
	.dbg	line, "src/dungeon.c", 321
	ldx     #$00
	lda     _player_direction
;
; }
;
	.dbg	line, "src/dungeon.c", 338
	beq     L0057
	cmp     #$01
	beq     L0058
	cmp     #$02
	beq     L0059
	cmp     #$03
	jeq     L005A
	jmp     L001F
;
; player_fire_dx[i] = 0;
;
	.dbg	line, "src/dungeon.c", 323
L0057:	lda     _i
	asl     a
	bcc     L0045
	inx
	clc
L0045:	adc     #<(_player_fire_dx)
	sta     ptr1
	txa
	adc     #>(_player_fire_dx)
	sta     ptr1+1
	lda     #$00
	dey
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; player_fire_dy[i] = -4 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 324
	tax
	lda     _i
	asl     a
	bcc     L0046
	inx
	clc
L0046:	adc     #<(_player_fire_dy)
	sta     ptr1
	txa
	adc     #>(_player_fire_dy)
	sta     ptr1+1
	lda     #$E0
	dey
	sta     (ptr1),y
	iny
	lda     #$FE
;
; break;
;
	.dbg	line, "src/dungeon.c", 325
	jmp     L005B
;
; player_fire_dx[i] = 0;
;
	.dbg	line, "src/dungeon.c", 327
L0058:	lda     _i
	asl     a
	bcc     L0047
	inx
	clc
L0047:	adc     #<(_player_fire_dx)
	sta     ptr1
	txa
	adc     #>(_player_fire_dx)
	sta     ptr1+1
	lda     #$00
	dey
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; player_fire_dy[i] = 4 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 328
	tax
	lda     _i
	asl     a
	bcc     L0048
	inx
	clc
L0048:	adc     #<(_player_fire_dy)
	sta     ptr1
	txa
	adc     #>(_player_fire_dy)
	sta     ptr1+1
	lda     #$20
	dey
	sta     (ptr1),y
	iny
	tya
;
; break;
;
	.dbg	line, "src/dungeon.c", 329
	jmp     L005B
;
; player_fire_dx[i] = -4 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 331
L0059:	lda     _i
	asl     a
	bcc     L0049
	inx
	clc
L0049:	adc     #<(_player_fire_dx)
	sta     ptr1
	txa
	adc     #>(_player_fire_dx)
	sta     ptr1+1
	lda     #$E0
	dey
	sta     (ptr1),y
	iny
	lda     #$FE
;
; break;
;
	.dbg	line, "src/dungeon.c", 333
	jmp     L006A
;
; player_fire_dx[i] = 4 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 335
L005A:	lda     _i
	asl     a
	bcc     L004B
	inx
	clc
L004B:	adc     #<(_player_fire_dx)
	sta     ptr1
	txa
	adc     #>(_player_fire_dx)
	sta     ptr1+1
	lda     #$20
	dey
	sta     (ptr1),y
	iny
	tya
L006A:	sta     (ptr1),y
;
; player_fire_dy[i] = 0;
;
	.dbg	line, "src/dungeon.c", 336
	ldx     #$00
	lda     _i
	asl     a
	bcc     L004C
	inx
	clc
L004C:	adc     #<(_player_fire_dy)
	sta     ptr1
	txa
	adc     #>(_player_fire_dy)
	sta     ptr1+1
	lda     #$00
	dey
	sta     (ptr1),y
	iny
L005B:	sta     (ptr1),y
;
; player_fire_direction[i] = player_direction;
;
	.dbg	line, "src/dungeon.c", 339
L001F:	ldy     _i
	lda     _player_direction
	sta     _player_fire_direction,y
;
; player_fire_active[i] = 1;
;
	.dbg	line, "src/dungeon.c", 340
	ldy     _i
	lda     #$01
	sta     _player_fire_active,y
;
; player_x += player_dx;
;
	.dbg	line, "src/dungeon.c", 344
L0013:	lda     _player_dx
	clc
	adc     _player_x
	sta     _player_x
	lda     _player_dx+1
	adc     _player_x+1
	sta     _player_x+1
;
; player_y += player_dy;
;
	.dbg	line, "src/dungeon.c", 345
	lda     _player_dy
	clc
	adc     _player_y
	sta     _player_y
	lda     _player_dy+1
	adc     _player_y+1
	sta     _player_y+1
;
; if (exiting_room()) return;
;
	.dbg	line, "src/dungeon.c", 347
	jsr     _exiting_room
	tax
	beq     L006B
;
; }
;
	.dbg	line, "src/dungeon.c", 379
	rts
;
; if (player_room_collision(INT(player_x), INT(player_y))) {
;
	.dbg	line, "src/dungeon.c", 349
L006B:	lda     _player_x
	ldx     _player_x+1
	jsr     asrax4
	jsr     asrax2
	jsr     pusha
	lda     _player_y
	ldx     _player_y+1
	jsr     asrax4
	jsr     asrax2
	jsr     _player_room_collision
	tax
	beq     L0027
;
; player_x -= player_dx;
;
	.dbg	line, "src/dungeon.c", 350
	lda     _player_dx
	eor     #$FF
	sec
	adc     _player_x
	sta     _player_x
	lda     _player_dx+1
	eor     #$FF
	adc     _player_x+1
	sta     _player_x+1
;
; player_y -= player_dy;
;
	.dbg	line, "src/dungeon.c", 351
	lda     _player_dy
	eor     #$FF
	sec
	adc     _player_y
	sta     _player_y
	lda     _player_dy+1
	eor     #$FF
	adc     _player_y+1
	sta     _player_y+1
;
; player_dx = player_dy = 0;
;
	.dbg	line, "src/dungeon.c", 352
	lda     #$00
	sta     _player_dy
	sta     _player_dy+1
	sta     _player_dx
	sta     _player_dx+1
;
; if (player_dy > 0) {
;
	.dbg	line, "src/dungeon.c", 355
L0027:	lda     _player_dy
	cmp     #$01
	lda     _player_dy+1
	sbc     #$00
	bvs     L0029
	eor     #$80
L0029:	bpl     L002B
;
; player_dy -= FRICTION;
;
	.dbg	line, "src/dungeon.c", 356
	lda     _player_dy
	sec
	sbc     #$04
	sta     _player_dy
	bcs     L002A
	dec     _player_dy+1
;
; if (player_dy < 0) {
;
	.dbg	line, "src/dungeon.c", 357
L002A:	ldx     _player_dy+1
	cpx     #$80
	bcc     L002B
;
; player_dy = 0;
;
	.dbg	line, "src/dungeon.c", 358
	lda     #$00
	sta     _player_dy
	sta     _player_dy+1
;
; if (player_dy < 0) {
;
	.dbg	line, "src/dungeon.c", 361
L002B:	ldx     _player_dy+1
	cpx     #$80
	bcc     L002E
;
; player_dy += FRICTION;
;
	.dbg	line, "src/dungeon.c", 362
	lda     #$04
	clc
	adc     _player_dy
	sta     _player_dy
	bcc     L002D
	inc     _player_dy+1
;
; if (player_dy > 0) {
;
	.dbg	line, "src/dungeon.c", 363
L002D:	lda     _player_dy
	cmp     #$01
	lda     _player_dy+1
	sbc     #$00
	bvs     L002F
	eor     #$80
L002F:	bpl     L002E
;
; player_dy = 0;
;
	.dbg	line, "src/dungeon.c", 364
	lda     #$00
	sta     _player_dy
	sta     _player_dy+1
;
; if (player_dx > 0) {
;
	.dbg	line, "src/dungeon.c", 367
L002E:	lda     _player_dx
	cmp     #$01
	lda     _player_dx+1
	sbc     #$00
	bvs     L0031
	eor     #$80
L0031:	bpl     L0033
;
; player_dx -= FRICTION;
;
	.dbg	line, "src/dungeon.c", 368
	lda     _player_dx
	sec
	sbc     #$04
	sta     _player_dx
	bcs     L0032
	dec     _player_dx+1
;
; if (player_dx < 0) {
;
	.dbg	line, "src/dungeon.c", 369
L0032:	ldx     _player_dx+1
	cpx     #$80
	bcc     L0033
;
; player_dx = 0;
;
	.dbg	line, "src/dungeon.c", 370
	lda     #$00
	sta     _player_dx
	sta     _player_dx+1
;
; if (player_dx < 0) {
;
	.dbg	line, "src/dungeon.c", 373
L0033:	ldx     _player_dx+1
	cpx     #$80
	bcc     L0036
;
; player_dx += FRICTION;
;
	.dbg	line, "src/dungeon.c", 374
	lda     #$04
	clc
	adc     _player_dx
	sta     _player_dx
	bcc     L0035
	inc     _player_dx+1
;
; if (player_dx > 0) {
;
	.dbg	line, "src/dungeon.c", 375
L0035:	lda     _player_dx
	cmp     #$01
	lda     _player_dx+1
	sbc     #$00
	bvs     L0037
	eor     #$80
L0037:	bpl     L0036
;
; player_dx = 0;
;
	.dbg	line, "src/dungeon.c", 376
	lda     #$00
	sta     _player_dx
	sta     _player_dx+1
;
; }
;
	.dbg	line, "src/dungeon.c", 379
L0036:	rts

	.dbg	line
.endproc

; ---------------------------------------------------------------
; unsigned char __near__ unobstructed_line (unsigned char x1, unsigned char y1, unsigned char x2, unsigned char y2)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_unobstructed_line: near

	.dbg	func, "unobstructed_line", "00", extern, "_unobstructed_line"
	.dbg	sym, "x1", "00", auto, 3
	.dbg	sym, "y1", "00", auto, 2
	.dbg	sym, "x2", "00", auto, 1
	.dbg	sym, "y2", "00", auto, 0

.segment	"CODE"

;
; unsigned char unobstructed_line(unsigned char x1, unsigned char y1, unsigned char x2, unsigned char y2) {
;
	.dbg	line, "src/dungeon.c", 382
	jsr     pusha
;
; if (x1 > x2) {
;
	.dbg	line, "src/dungeon.c", 383
	ldy     #$03
	lda     (sp),y
	ldy     #$01
	cmp     (sp),y
	bcc     L0002
	beq     L0002
;
; xm = x1;
;
	.dbg	line, "src/dungeon.c", 384
	ldy     #$03
	lda     (sp),y
	sta     _xm
;
; x1 = x2;
;
	.dbg	line, "src/dungeon.c", 385
	ldy     #$01
	lda     (sp),y
	ldy     #$03
	sta     (sp),y
;
; x2 = xm;
;
	.dbg	line, "src/dungeon.c", 386
	lda     _xm
	ldy     #$01
	sta     (sp),y
;
; if (y1 > y2) {
;
	.dbg	line, "src/dungeon.c", 388
L0002:	iny
	lda     (sp),y
	ldy     #$00
	cmp     (sp),y
	bcc     L0003
	beq     L0003
;
; ym = y1;
;
	.dbg	line, "src/dungeon.c", 389
	ldy     #$02
	lda     (sp),y
	sta     _ym
;
; y1 = y2;
;
	.dbg	line, "src/dungeon.c", 390
	ldy     #$00
	lda     (sp),y
	ldy     #$02
	sta     (sp),y
;
; y2 = ym;
;
	.dbg	line, "src/dungeon.c", 391
	lda     _ym
	ldy     #$00
	sta     (sp),y
;
; if (x2 - x1 < 0x10) {
;
	.dbg	line, "src/dungeon.c", 393
L0003:	iny
	lda     (sp),y
	sec
	ldy     #$03
	sbc     (sp),y
	pha
	lda     #$00
	sbc     #$00
	tax
	pla
	cmp     #$10
	txa
	sbc     #$00
	bvc     L0005
	eor     #$80
L0005:	bpl     L0004
;
; xm = (x2 - x1) / 2 + x1;
;
	.dbg	line, "src/dungeon.c", 394
	ldy     #$01
	lda     (sp),y
	sec
	ldy     #$03
	sbc     (sp),y
	pha
	lda     #$00
	sbc     #$00
	tax
	pla
	cpx     #$00
	bpl     L0006
	sta     regsave
	stx     regsave+1
	cpx     #$FF
	bne     L0008
	cmp     #$FF
L0008:	jsr     boolult
	lsr     a
	lda     regsave
	ldx     regsave+1
	bcs     L0006
	lda     #$00
	jmp     L0007
L0006:	jsr     asrax1
L0007:	sta     ptr1
	lda     (sp),y
	clc
	adc     ptr1
	sta     _xm
;
; for(temp_y = y1; temp_y < y2; temp_y += 16) {
;
	.dbg	line, "src/dungeon.c", 395
	dey
	lda     (sp),y
L001C:	sta     _temp_y
	ldx     #$00
	lda     _temp_y
	ldy     #$00
	cmp     (sp),y
	bcs     L001F
;
; if (point_room_collision(xm, temp_y)) return 0;
;
	.dbg	line, "src/dungeon.c", 396
	lda     _xm
	jsr     pusha
	lda     _temp_y
	jsr     _point_room_collision
	tax
	beq     L001E
	ldx     #$00
	jmp     L001B
;
; for(temp_y = y1; temp_y < y2; temp_y += 16) {
;
	.dbg	line, "src/dungeon.c", 395
L001E:	lda     #$10
	clc
	adc     _temp_y
	jmp     L001C
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 398
L001F:	lda     #$01
	jmp     L0001
;
; } else if (y2 - y1 < 0x10) {
;
	.dbg	line, "src/dungeon.c", 399
L0004:	ldy     #$00
	lda     (sp),y
	sec
	ldy     #$02
	sbc     (sp),y
	pha
	lda     #$00
	sbc     #$00
	tax
	pla
	cmp     #$10
	txa
	sbc     #$00
	bvc     L0010
	eor     #$80
L0010:	asl     a
	lda     #$00
	tax
	bcc     L0001
;
; ym = (y2 - y1) / 2 + y1;
;
	.dbg	line, "src/dungeon.c", 400
	lda     (sp,x)
	sec
	ldy     #$02
	sbc     (sp),y
	pha
	txa
	sbc     #$00
	tax
	pla
	cpx     #$00
	bpl     L0011
	sta     regsave
	stx     regsave+1
	cpx     #$FF
	bne     L0013
	cmp     #$FF
L0013:	jsr     boolult
	lsr     a
	lda     regsave
	ldx     regsave+1
	bcs     L0011
	lda     #$00
	jmp     L0012
L0011:	jsr     asrax1
L0012:	sta     ptr1
	lda     (sp),y
	clc
	adc     ptr1
	sta     _ym
;
; for(temp_x = x1; temp_x < x2; temp_x += 16) {
;
	.dbg	line, "src/dungeon.c", 401
	iny
	lda     (sp),y
L001D:	sta     _temp_x
	ldx     #$00
	lda     _temp_x
	ldy     #$01
	cmp     (sp),y
	bcs     L0021
;
; if (point_room_collision(temp_x, ym)) return 0;
;
	.dbg	line, "src/dungeon.c", 402
	lda     _temp_x
	jsr     pusha
	lda     _ym
	jsr     _point_room_collision
	tax
	beq     L0020
	ldx     #$00
	jmp     L001B
;
; for(temp_x = x1; temp_x < x2; temp_x += 16) {
;
	.dbg	line, "src/dungeon.c", 401
L0020:	lda     #$10
	clc
	adc     _temp_x
	jmp     L001D
;
; return 1;
;
	.dbg	line, "src/dungeon.c", 404
L0021:	tya
	jmp     L0001
;
; return 0;
;
	.dbg	line, "src/dungeon.c", 406
L001B:	txa
;
; }
;
	.dbg	line, "src/dungeon.c", 407
L0001:	jmp     incsp4

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ entities_handler (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_entities_handler: near

	.dbg	func, "entities_handler", "00", extern, "_entities_handler"
	.dbg	sym, "coordinates", "00", auto, -2

.segment	"CODE"

;
; if (shooting_cooldown > 0) --shooting_cooldown;
;
	.dbg	line, "src/dungeon.c", 412
	jsr     decsp2
	lda     _shooting_cooldown
	beq     L0170
	dec     _shooting_cooldown
;
; for (i = 0; i < num_entities; i++) {
;
	.dbg	line, "src/dungeon.c", 414
	lda     #$00
L0170:	sta     _i
L0171:	lda     _i
	cmp     _num_entities
	jcs     L0004
;
; if (entity_lives[i] == 0) continue;
;
	.dbg	line, "src/dungeon.c", 415
	ldy     _i
	lda     _entity_lives,y
	jeq     L01AA
;
; switch (entity_type[i]) {
;
	.dbg	line, "src/dungeon.c", 416
	ldy     _i
	ldx     #$00
	lda     _entity_type,y
;
; }
;
	.dbg	line, "src/dungeon.c", 546
	beq     L0172
	cmp     #$01
	jeq     L017A
	cmp     #$02
	jeq     L0175
	jmp     L01AA
;
; if (entity_x[i] >= player_x && entity_x[i] < player_x + FP(0x10, 00) &&
;
	.dbg	line, "src/dungeon.c", 418
L0172:	lda     _i
	asl     a
	bcc     L0109
	inx
	clc
L0109:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_x
	txa
	sbc     _player_x+1
	bvs     L00FE
	eor     #$80
L00FE:	jpl     L01AA
	ldx     #$00
	lda     _i
	asl     a
	bcc     L010A
	inx
	clc
L010A:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_x
	pha
	lda     _player_x+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	jpl     L01AA
;
; entity_y[i] >= player_y && entity_y[i] < player_y + FP(0x10, 00)) {
;
	.dbg	line, "src/dungeon.c", 419
	ldx     #$00
	lda     _i
	asl     a
	bcc     L010B
	inx
	clc
L010B:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_y
	txa
	sbc     _player_y+1
	bvs     L00FF
	eor     #$80
L00FF:	jpl     L01AA
	ldx     #$00
	lda     _i
	asl     a
	bcc     L010C
	inx
	clc
L010C:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_y
	pha
	lda     _player_y+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	jpl     L01AA
;
; damage_player();
;
	.dbg	line, "src/dungeon.c", 420
	jsr     _damage_player
;
; break;
;
	.dbg	line, "src/dungeon.c", 421
	jmp     L01AA
;
; entity_x[i] += entity_dx[i];
;
	.dbg	line, "src/dungeon.c", 425
L0175:	lda     _i
	asl     a
	bcc     L010D
	inx
	clc
L010D:	adc     #<(_entity_x)
	tay
	txa
	adc     #>(_entity_x)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L010E
	inx
	clc
L010E:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; entity_y[i] += entity_dy[i];
;
	.dbg	line, "src/dungeon.c", 426
	ldx     #$00
	lda     _i
	asl     a
	bcc     L010F
	inx
	clc
L010F:	adc     #<(_entity_y)
	tay
	txa
	adc     #>(_entity_y)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0110
	inx
	clc
L0110:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; if (entity_x[i] >= player_x && entity_x[i] < player_x + FP(0x10, 00) &&
;
	.dbg	line, "src/dungeon.c", 427
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0111
	inx
	clc
L0111:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_x
	txa
	sbc     _player_x+1
	bvs     L0100
	eor     #$80
L0100:	asl     a
	ldx     #$00
	jcc     L0178
	lda     _i
	asl     a
	bcc     L0112
	inx
	clc
L0112:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_x
	pha
	lda     _player_x+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	bpl     L0013
;
; entity_y[i] >= player_y && entity_y[i] < player_y + FP(0x10, 00)) {
;
	.dbg	line, "src/dungeon.c", 428
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0113
	inx
	clc
L0113:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_y
	txa
	sbc     _player_y+1
	bvs     L0101
	eor     #$80
L0101:	asl     a
	ldx     #$00
	bcc     L0178
	lda     _i
	asl     a
	bcc     L0114
	inx
	clc
L0114:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_y
	pha
	lda     _player_y+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	bmi     L0014
L0013:	ldx     #$00
	jmp     L0178
;
; entity_lives[i] = 0;
;
	.dbg	line, "src/dungeon.c", 429
L0014:	ldy     _i
	lda     #$00
	sta     _entity_lives,y
;
; damage_player();
;
	.dbg	line, "src/dungeon.c", 430
	jsr     _damage_player
;
; break;
;
	.dbg	line, "src/dungeon.c", 431
	jmp     L01AA
;
; if (entity_x[i] < FP(0x10, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 433
L0178:	lda     _i
	asl     a
	bcc     L0115
	inx
	clc
L0115:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$04
	bvc     L0018
	eor     #$80
L0018:	jmi     L0179
;
; entity_x[i] >= FP(0xf0, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 434
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0116
	inx
	clc
L0116:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$3C
	bvs     L001A
	eor     #$80
L001A:	jmi     L0179
;
; entity_y[i] < FP(0x10, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 435
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0117
	inx
	clc
L0117:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$04
	bvc     L001B
	eor     #$80
L001B:	bmi     L0179
;
; entity_y[i] >= FP(0xb0, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 436
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0118
	inx
	clc
L0118:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$2C
	bvs     L001C
	eor     #$80
L001C:	bmi     L0179
;
; point_room_collision(INT(entity_x[i]), INT(entity_y[i]))) {
;
	.dbg	line, "src/dungeon.c", 437
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0119
	inx
	clc
L0119:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	jsr     pusha
	ldx     #$00
	lda     _i
	asl     a
	bcc     L011A
	inx
	clc
L011A:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	jsr     _point_room_collision
	tax
	jeq     L01AA
;
; entity_lives[i] = 0;
;
	.dbg	line, "src/dungeon.c", 438
L0179:	ldy     _i
	lda     #$00
	sta     _entity_lives,y
;
; break;
;
	.dbg	line, "src/dungeon.c", 439
	jmp     L01AA
;
; if (entity_x[i] >= player_x && entity_x[i] < player_x + FP(0x10, 00) &&
;
	.dbg	line, "src/dungeon.c", 443
L017A:	lda     _i
	asl     a
	bcc     L011B
	inx
	clc
L011B:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_x
	txa
	sbc     _player_x+1
	bvs     L0102
	eor     #$80
L0102:	asl     a
	ldx     #$00
	jcc     L017D
	lda     _i
	asl     a
	bcc     L011C
	inx
	clc
L011C:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_x
	pha
	lda     _player_x+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	bpl     L0021
;
; entity_y[i] >= player_y && entity_y[i] < player_y + FP(0x10, 00)) {
;
	.dbg	line, "src/dungeon.c", 444
	ldx     #$00
	lda     _i
	asl     a
	bcc     L011D
	inx
	clc
L011D:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     _player_y
	txa
	sbc     _player_y+1
	bvs     L0103
	eor     #$80
L0103:	asl     a
	ldx     #$00
	bcc     L017D
	lda     _i
	asl     a
	bcc     L011E
	inx
	clc
L011E:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	lda     _player_y
	pha
	lda     _player_y+1
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	bmi     L0022
L0021:	ldx     #$00
	jmp     L017D
;
; damage_player();
;
	.dbg	line, "src/dungeon.c", 445
L0022:	jsr     _damage_player
;
; break;
;
	.dbg	line, "src/dungeon.c", 446
	jmp     L01AA
;
; if (entity_x[i] == entity_target_x[i] && entity_y[i] == entity_target_y[i]) {
;
	.dbg	line, "src/dungeon.c", 448
L017D:	lda     _i
	asl     a
	bcc     L011F
	inx
	clc
L011F:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0120
	inx
	clc
L0120:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bne     L0025
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0121
	inx
	clc
L0121:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0122
	inx
	clc
L0122:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	beq     L0026
L0025:	ldx     #$00
	jmp     L018A
;
; temp = entity_patrol_index[i];
;
	.dbg	line, "src/dungeon.c", 449
L0026:	ldy     _i
	lda     _entity_patrol_index,y
	sta     _temp
;
; ++temp;
;
	.dbg	line, "src/dungeon.c", 450
	inc     _temp
;
; if (temp >= num_entity_patrol_points[i]) {
;
	.dbg	line, "src/dungeon.c", 451
	lda     _temp
	ldy     _i
	cmp     _num_entity_patrol_points,y
	bcc     L0029
;
; temp = 0;
;
	.dbg	line, "src/dungeon.c", 452
	lda     #$00
	sta     _temp
;
; entity_patrol_index[i] = temp;
;
	.dbg	line, "src/dungeon.c", 454
L0029:	ldy     _i
	lda     _temp
	sta     _entity_patrol_index,y
;
; coordinates = (*entity_patrol_points[i])[temp];
;
	.dbg	line, "src/dungeon.c", 455
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0123
	inx
	clc
L0123:	adc     #<(_entity_patrol_points)
	sta     ptr1
	txa
	adc     #>(_entity_patrol_points)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     ptr1
	stx     ptr1+1
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L0124
	inx
	clc
L0124:	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     stax0sp
;
; entity_target_x[i] = FP(coordinates.x, 0x00);
;
	.dbg	line, "src/dungeon.c", 456
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0125
	inx
	clc
L0125:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	ldx     #$00
	ldy     #$00
	lda     (sp),y
	jsr     aslax4
	jsr     aslax2
	sta     (ptr1),y
	iny
	txa
	sta     (ptr1),y
;
; entity_target_y[i] = FP(coordinates.y, 0x00);
;
	.dbg	line, "src/dungeon.c", 457
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0126
	inx
	clc
L0126:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	ldx     #$00
	lda     (sp),y
	jsr     aslax4
	jsr     aslax2
	dey
	sta     (ptr1),y
	iny
	txa
	sta     (ptr1),y
;
; entity_dx[i] = entity_target_x[i] - entity_x[i];
;
	.dbg	line, "src/dungeon.c", 458
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0127
	inx
	clc
L0127:	adc     #<(_entity_dx)
	tay
	txa
	adc     #>(_entity_dx)
	tax
	tya
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0128
	inx
	clc
L0128:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0129
	inx
	clc
L0129:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tossubax
	ldy     #$00
	jsr     staxspidx
;
; entity_dy[i] = entity_target_y[i] - entity_y[i];
;
	.dbg	line, "src/dungeon.c", 459
	ldx     #$00
	lda     _i
	asl     a
	bcc     L012A
	inx
	clc
L012A:	adc     #<(_entity_dy)
	tay
	txa
	adc     #>(_entity_dy)
	tax
	tya
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L012B
	inx
	clc
L012B:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L012C
	inx
	clc
L012C:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tossubax
	ldy     #$00
	jsr     staxspidx
;
; while(entity_dx[i] > MAX_PATROL_SPEED ||
;
	.dbg	line, "src/dungeon.c", 461
	jmp     L003D
;
; if (entity_dx[i] > 1 || entity_dx[i] < -1) {
;
	.dbg	line, "src/dungeon.c", 465
L017E:	lda     _i
	asl     a
	bcc     L012D
	inx
	clc
L012D:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$02
	txa
	sbc     #$00
	bvs     L0036
	eor     #$80
L0036:	bmi     L017F
	ldx     #$00
	lda     _i
	asl     a
	bcc     L012E
	inx
	clc
L012E:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$FF
	txa
	sbc     #$FF
	bvc     L0038
	eor     #$80
L0038:	bpl     L01AB
;
; entity_dx[i] /= 2;
;
	.dbg	line, "src/dungeon.c", 466
L017F:	ldx     #$00
	lda     _i
	asl     a
	bcc     L012F
	inx
	clc
L012F:	adc     #<(_entity_dx)
	tay
	txa
	adc     #>(_entity_dx)
	tax
	tya
	sta     sreg
	stx     sreg+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cpx     #$00
	bpl     L003A
	sta     regsave
	stx     regsave+1
	cpx     #$FF
	bne     L003C
	cmp     #$FF
L003C:	jsr     boolult
	lsr     a
	lda     regsave
	ldx     regsave+1
	bcs     L003A
	ldx     #$00
	txa
	jmp     L0180
L003A:	jsr     asrax1
L0180:	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; if (entity_dy[i] > 1 || entity_dy[i] < -1) {
;
	.dbg	line, "src/dungeon.c", 468
L01AB:	ldx     #$00
	lda     _i
	asl     a
	bcc     L0130
	inx
	clc
L0130:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$02
	txa
	sbc     #$00
	bvs     L003E
	eor     #$80
L003E:	bmi     L0182
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0131
	inx
	clc
L0131:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$FF
	txa
	sbc     #$FF
	bvc     L0040
	eor     #$80
L0040:	bpl     L003D
;
; entity_dy[i] /= 2;
;
	.dbg	line, "src/dungeon.c", 469
L0182:	ldx     #$00
	lda     _i
	asl     a
	bcc     L0132
	inx
	clc
L0132:	adc     #<(_entity_dy)
	tay
	txa
	adc     #>(_entity_dy)
	tax
	tya
	sta     sreg
	stx     sreg+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cpx     #$00
	bpl     L0042
	sta     regsave
	stx     regsave+1
	cpx     #$FF
	bne     L0044
	cmp     #$FF
L0044:	jsr     boolult
	lsr     a
	lda     regsave
	ldx     regsave+1
	bcs     L0042
	ldx     #$00
	txa
	jmp     L0183
L0042:	jsr     asrax1
L0183:	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; while(entity_dx[i] > MAX_PATROL_SPEED ||
;
	.dbg	line, "src/dungeon.c", 461
L003D:	ldx     #$00
	lda     _i
	asl     a
	bcc     L0133
	inx
	clc
L0133:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$31
	txa
	sbc     #$00
	bvs     L002F
	eor     #$80
L002F:	asl     a
	ldx     #$00
	jcs     L017E
;
; entity_dx[i] < -MAX_PATROL_SPEED ||
;
	.dbg	line, "src/dungeon.c", 462
	lda     _i
	asl     a
	bcc     L0134
	inx
	clc
L0134:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$D0
	txa
	sbc     #$FF
	bvc     L0031
	eor     #$80
L0031:	asl     a
	ldx     #$00
	jcs     L017E
;
; entity_dy[i] > MAX_PATROL_SPEED ||
;
	.dbg	line, "src/dungeon.c", 463
	lda     _i
	asl     a
	bcc     L0135
	inx
	clc
L0135:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$31
	txa
	sbc     #$00
	bvs     L0032
	eor     #$80
L0032:	asl     a
	ldx     #$00
	jcs     L017E
;
; entity_dy[i] < -MAX_PATROL_SPEED) {
;
	.dbg	line, "src/dungeon.c", 464
	lda     _i
	asl     a
	bcc     L0136
	inx
	clc
L0136:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$D0
	txa
	sbc     #$FF
	bvc     L0033
	eor     #$80
L0033:	asl     a
	ldx     #$00
	jcs     L017E
;
; if (entity_dy[i] > entity_dx[i] && entity_dy[i] > -entity_dx[i]) {
;
	.dbg	line, "src/dungeon.c", 472
	lda     _i
	asl     a
	bcc     L0137
	inx
	clc
L0137:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0138
	inx
	clc
L0138:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bmi     L01AC
	beq     L01AC
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0139
	inx
	clc
L0139:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L013A
	inx
	clc
L013A:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     negax
	jsr     tosicmp
	beq     L01AC
	bmi     L01AC
;
; entity_direction[i] = Down;
;
	.dbg	line, "src/dungeon.c", 473
	ldy     _i
	lda     #$01
	sta     _entity_direction,y
;
; if (entity_dy[i] < entity_dx[i] && entity_dy[i] < -entity_dx[i]) {
;
	.dbg	line, "src/dungeon.c", 475
L01AC:	ldx     #$00
	lda     _i
	asl     a
	bcc     L013B
	inx
	clc
L013B:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L013C
	inx
	clc
L013C:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bpl     L01AD
	ldx     #$00
	lda     _i
	asl     a
	bcc     L013D
	inx
	clc
L013D:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L013E
	inx
	clc
L013E:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     negax
	jsr     tosicmp
	bpl     L01AD
;
; entity_direction[i] = Up;
;
	.dbg	line, "src/dungeon.c", 476
	ldy     _i
	lda     #$00
	sta     _entity_direction,y
;
; if (entity_dx[i] > entity_dy[i] && entity_dx[i] > -entity_dy[i]) {
;
	.dbg	line, "src/dungeon.c", 478
L01AD:	ldx     #$00
	lda     _i
	asl     a
	bcc     L013F
	inx
	clc
L013F:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0140
	inx
	clc
L0140:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bmi     L01AE
	beq     L01AE
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0141
	inx
	clc
L0141:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0142
	inx
	clc
L0142:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     negax
	jsr     tosicmp
	beq     L01AE
	bmi     L01AE
;
; entity_direction[i] = Right;
;
	.dbg	line, "src/dungeon.c", 479
	ldy     _i
	lda     #$03
	sta     _entity_direction,y
;
; if (entity_dx[i] < entity_dy[i] && entity_dx[i] < -entity_dy[i]) {
;
	.dbg	line, "src/dungeon.c", 481
L01AE:	ldx     #$00
	lda     _i
	asl     a
	bcc     L0143
	inx
	clc
L0143:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0144
	inx
	clc
L0144:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	jpl     L01A0
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0145
	inx
	clc
L0145:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0146
	inx
	clc
L0146:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     negax
	jsr     tosicmp
	jpl     L01A0
;
; entity_direction[i] = Left;
;
	.dbg	line, "src/dungeon.c", 482
	ldy     _i
	lda     #$02
	sta     _entity_direction,y
;
; } else {
;
	.dbg	line, "src/dungeon.c", 484
	jmp     L01A0
;
; entity_x[i] += entity_dx[i];
;
	.dbg	line, "src/dungeon.c", 485
L018A:	lda     _i
	asl     a
	bcc     L0147
	inx
	clc
L0147:	adc     #<(_entity_x)
	tay
	txa
	adc     #>(_entity_x)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0148
	inx
	clc
L0148:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; entity_y[i] += entity_dy[i];
;
	.dbg	line, "src/dungeon.c", 486
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0149
	inx
	clc
L0149:	adc     #<(_entity_y)
	tay
	txa
	adc     #>(_entity_y)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L014A
	inx
	clc
L014A:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; if ((entity_dx[i] > 0 && entity_x[i] >= entity_target_x[i]) ||
;
	.dbg	line, "src/dungeon.c", 488
	ldx     #$00
	lda     _i
	asl     a
	bcc     L014B
	inx
	clc
L014B:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$01
	txa
	sbc     #$00
	bvs     L005B
	eor     #$80
L005B:	asl     a
	ldx     #$00
	bcc     L018D
	lda     _i
	asl     a
	bcc     L014C
	inx
	clc
L014C:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L014D
	inx
	clc
L014D:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bpl     L0061
	ldx     #$00
;
; (entity_dx[i] < 0 && entity_x[i] <= entity_target_x[i]) ) {
;
	.dbg	line, "src/dungeon.c", 489
L018D:	lda     _i
	asl     a
	bcc     L014E
	inx
	clc
L014E:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	cpx     #$80
	ldx     #$00
	jcc     L0195
	lda     _i
	asl     a
	bcc     L014F
	inx
	clc
L014F:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0150
	inx
	clc
L0150:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bmi     L0061
	bne     L01AF
L0061:	ldx     #$00
;
; entity_dx[i] = 0;
;
	.dbg	line, "src/dungeon.c", 490
	lda     _i
	asl     a
	bcc     L0151
	inx
	clc
L0151:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; entity_x[i] = entity_target_x[i];
;
	.dbg	line, "src/dungeon.c", 491
	tax
	lda     _i
	asl     a
	bcc     L0152
	inx
	clc
L0152:	adc     #<(_entity_x)
	sta     sreg
	txa
	adc     #>(_entity_x)
	sta     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0153
	inx
	clc
L0153:	adc     #<(_entity_target_x)
	sta     ptr1
	txa
	adc     #>(_entity_target_x)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; if ((entity_dy[i] > 0 && entity_y[i] >= entity_target_y[i]) ||
;
	.dbg	line, "src/dungeon.c", 494
L01AF:	ldx     #$00
L0195:	lda     _i
	asl     a
	bcc     L0154
	inx
	clc
L0154:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$01
	txa
	sbc     #$00
	bvs     L0065
	eor     #$80
L0065:	asl     a
	ldx     #$00
	bcc     L0198
	lda     _i
	asl     a
	bcc     L0155
	inx
	clc
L0155:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0156
	inx
	clc
L0156:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bpl     L006B
	ldx     #$00
;
; (entity_dy[i] < 0 && entity_y[i] <= entity_target_y[i]) ) {
;
	.dbg	line, "src/dungeon.c", 495
L0198:	lda     _i
	asl     a
	bcc     L0157
	inx
	clc
L0157:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	cpx     #$80
	jcc     L01A0
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0158
	inx
	clc
L0158:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0159
	inx
	clc
L0159:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	bmi     L006B
	bne     L01A0
L006B:	ldx     #$00
;
; entity_dy[i] = 0;
;
	.dbg	line, "src/dungeon.c", 496
	lda     _i
	asl     a
	bcc     L015A
	inx
	clc
L015A:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; entity_y[i] = entity_target_y[i];
;
	.dbg	line, "src/dungeon.c", 497
	tax
	lda     _i
	asl     a
	bcc     L015B
	inx
	clc
L015B:	adc     #<(_entity_y)
	sta     sreg
	txa
	adc     #>(_entity_y)
	sta     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L015C
	inx
	clc
L015C:	adc     #<(_entity_target_y)
	sta     ptr1
	txa
	adc     #>(_entity_target_y)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; if (shooting_cooldown == 0 &&
;
	.dbg	line, "src/dungeon.c", 501
L01A0:	lda     _shooting_cooldown
	jne     L01AA
;
; num_entities < MAX_ENTITIES &&
;
	.dbg	line, "src/dungeon.c", 502
	lda     _num_entities
	cmp     #$10
	jcs     L01AA
;
; ((get_frame_count() + i) & 0b011) == 0 &&
;
	.dbg	line, "src/dungeon.c", 503
	jsr     _get_frame_count
	clc
	adc     _i
	and     #$03
	jne     L01AA
;
; unobstructed_line(INT(player_x) + 8, INT(player_y) + 4, INT(entity_x[i]) + 8, INT(entity_y[i]) + 4)) {
;
	.dbg	line, "src/dungeon.c", 504
	jsr     decsp3
	lda     _player_x
	ldx     _player_x+1
	jsr     asrax4
	jsr     asrax2
	clc
	adc     #$08
	ldy     #$02
	sta     (sp),y
	lda     _player_y
	ldx     _player_y+1
	jsr     asrax4
	jsr     asrax2
	clc
	adc     #$04
	dey
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L015D
	inx
	clc
L015D:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	clc
	adc     #$08
	sta     (sp),y
	ldx     #$00
	lda     _i
	asl     a
	bcc     L015E
	inx
	clc
L015E:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	clc
	adc     #$04
	jsr     _unobstructed_line
	tax
	jeq     L01AA
;
; shooting_cooldown = 24;
;
	.dbg	line, "src/dungeon.c", 505
	lda     #$18
	sta     _shooting_cooldown
;
; for(temp = 0; temp < num_entities; temp++) {
;
	.dbg	line, "src/dungeon.c", 506
	lda     #$00
	sta     _temp
L01A2:	lda     _temp
	cmp     _num_entities
	bcs     L01A3
;
; if (entity_lives[temp] == 0) break;
;
	.dbg	line, "src/dungeon.c", 507
	ldy     _temp
	lda     _entity_lives,y
	beq     L01A3
;
; for(temp = 0; temp < num_entities; temp++) {
;
	.dbg	line, "src/dungeon.c", 506
	inc     _temp
	jmp     L01A2
;
; if (temp == num_entities) num_entities++;
;
	.dbg	line, "src/dungeon.c", 509
L01A3:	lda     _temp
	cmp     _num_entities
	bne     L007D
	inc     _num_entities
;
; entity_type[temp] = Fireball;
;
	.dbg	line, "src/dungeon.c", 510
L007D:	ldy     _temp
	lda     #$02
	sta     _entity_type,y
;
; entity_lives[temp] = 0xff;
;
	.dbg	line, "src/dungeon.c", 511
	ldy     _temp
	lda     #$FF
	sta     _entity_lives,y
;
; entity_x[temp] = entity_x[i] + 0x08;
;
	.dbg	line, "src/dungeon.c", 512
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L015F
	inx
	clc
L015F:	adc     #<(_entity_x)
	sta     sreg
	txa
	adc     #>(_entity_x)
	sta     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0160
	inx
	clc
L0160:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     #$08
	bcc     L01A4
	inx
L01A4:	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; entity_y[temp] = entity_y[i] + 0x08;
;
	.dbg	line, "src/dungeon.c", 513
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L0161
	inx
	clc
L0161:	adc     #<(_entity_y)
	sta     sreg
	txa
	adc     #>(_entity_y)
	sta     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0162
	inx
	clc
L0162:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     #$08
	bcc     L01A5
	inx
L01A5:	sta     (sreg),y
	iny
	txa
	sta     (sreg),y
;
; if (player_x > entity_x[i] + FP(0x20, 0x00)) {
;
	.dbg	line, "src/dungeon.c", 514
	lda     _player_x
	ldx     _player_x+1
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0163
	inx
	clc
L0163:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	clc
	adc     #$08
	tax
	pla
	jsr     tosicmp
	bmi     L0082
	beq     L0082
;
; entity_direction[temp] = Right;
;
	.dbg	line, "src/dungeon.c", 515
	ldy     _temp
	lda     #$03
	sta     _entity_direction,y
;
; } else if (player_x < entity_x[i] - FP(0x10, 0x00)) {
;
	.dbg	line, "src/dungeon.c", 516
	jmp     L0084
L0082:	lda     _player_x
	ldx     _player_x+1
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0164
	inx
	clc
L0164:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	sec
	sbc     #$04
	tax
	pla
	jsr     tosicmp
	bpl     L0085
;
; entity_direction[temp] = Left;
;
	.dbg	line, "src/dungeon.c", 517
	ldy     _temp
	lda     #$02
	sta     _entity_direction,y
;
; } else if (player_y > entity_y[i] + FP(0x20, 0x00)) {
;
	.dbg	line, "src/dungeon.c", 518
	jmp     L0084
L0085:	lda     _player_y
	ldx     _player_y+1
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0165
	inx
	clc
L0165:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	clc
	adc     #$08
	tax
	pla
	jsr     tosicmp
	bmi     L0088
	beq     L0088
;
; entity_direction[temp] = Down;
;
	.dbg	line, "src/dungeon.c", 519
	ldy     _temp
	lda     #$01
	sta     _entity_direction,y
;
; } else if (player_y < entity_y[i] - FP(0x10, 0x00)) {
;
	.dbg	line, "src/dungeon.c", 520
	jmp     L0084
L0088:	lda     _player_y
	ldx     _player_y+1
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0166
	inx
	clc
L0166:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	sec
	sbc     #$04
	tax
	pla
	jsr     tosicmp
	bpl     L008B
;
; entity_direction[temp] = Up;
;
	.dbg	line, "src/dungeon.c", 521
	ldy     _temp
	lda     #$00
	sta     _entity_direction,y
;
; } else {
;
	.dbg	line, "src/dungeon.c", 522
	jmp     L0084
;
; entity_direction[temp] = entity_direction[i];
;
	.dbg	line, "src/dungeon.c", 523
L008B:	lda     #<(_entity_direction)
	ldx     #>(_entity_direction)
	clc
	adc     _temp
	bcc     L008E
	inx
L008E:	sta     ptr1
	stx     ptr1+1
	ldy     _i
	lda     _entity_direction,y
	ldy     #$00
	sta     (ptr1),y
;
; switch(entity_direction[temp]) {
;
	.dbg	line, "src/dungeon.c", 526
L0084:	ldy     _temp
	ldx     #$00
	lda     _entity_direction,y
;
; }
;
	.dbg	line, "src/dungeon.c", 543
	beq     L01A6
	cmp     #$01
	beq     L01A7
	cmp     #$02
	beq     L01A8
	cmp     #$03
	jeq     L01A9
	jmp     L01AA
;
; entity_dx[temp] = 0;
;
	.dbg	line, "src/dungeon.c", 528
L01A6:	lda     _temp
	asl     a
	bcc     L0167
	inx
	clc
L0167:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; entity_dy[temp] = -2 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 529
	tax
	lda     _temp
	asl     a
	bcc     L0168
	inx
	clc
L0168:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	lda     #$70
	dey
	sta     (ptr1),y
	iny
	lda     #$FF
;
; break;
;
	.dbg	line, "src/dungeon.c", 530
	jmp     L01B0
;
; entity_dx[temp] = 0;
;
	.dbg	line, "src/dungeon.c", 532
L01A7:	lda     _temp
	asl     a
	bcc     L0169
	inx
	clc
L0169:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	iny
	sta     (ptr1),y
;
; entity_dy[temp] = 2 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 533
	tax
	lda     _temp
	asl     a
	bcc     L016A
	inx
	clc
L016A:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	lda     #$90
	dey
	sta     (ptr1),y
	iny
	lda     #$00
;
; break;
;
	.dbg	line, "src/dungeon.c", 534
	jmp     L01B0
;
; entity_dx[temp] = -2 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 536
L01A8:	lda     _temp
	asl     a
	bcc     L016B
	inx
	clc
L016B:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     #$70
	ldy     #$00
	sta     (ptr1),y
	iny
	lda     #$FF
;
; break;
;
	.dbg	line, "src/dungeon.c", 538
	jmp     L01C1
;
; entity_dx[temp] = 2 * MAX_SPEED;
;
	.dbg	line, "src/dungeon.c", 540
L01A9:	lda     _temp
	asl     a
	bcc     L016D
	inx
	clc
L016D:	adc     #<(_entity_dx)
	sta     ptr1
	txa
	adc     #>(_entity_dx)
	sta     ptr1+1
	lda     #$90
	ldy     #$00
	sta     (ptr1),y
	iny
	lda     #$00
L01C1:	sta     (ptr1),y
;
; entity_dy[temp] = 0;
;
	.dbg	line, "src/dungeon.c", 541
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L016E
	inx
	clc
L016E:	adc     #<(_entity_dy)
	sta     ptr1
	txa
	adc     #>(_entity_dy)
	sta     ptr1+1
	lda     #$00
	dey
	sta     (ptr1),y
	iny
L01B0:	sta     (ptr1),y
;
; for (i = 0; i < num_entities; i++) {
;
	.dbg	line, "src/dungeon.c", 414
L01AA:	inc     _i
	jmp     L0171
;
; }
;
	.dbg	line, "src/dungeon.c", 548
L0004:	jmp     incsp2

	.dbg	line
.endproc

; ---------------------------------------------------------------
; void __near__ player_fire_handler (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_player_fire_handler: near

	.dbg	func, "player_fire_handler", "00", extern, "_player_fire_handler"

.segment	"CODE"

;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 551
	lda     #$00
	sta     _i
L0044:	lda     _i
	cmp     #$05
	bcc     L004E
;
; }
;
	.dbg	line, "src/dungeon.c", 583
	rts
;
; if (!player_fire_active[i]) continue;
;
	.dbg	line, "src/dungeon.c", 552
L004E:	ldy     _i
	lda     _player_fire_active,y
	jeq     L004D
;
; player_fire_x[i] += player_fire_dx[i];
;
	.dbg	line, "src/dungeon.c", 554
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0030
	inx
	clc
L0030:	adc     #<(_player_fire_x)
	tay
	txa
	adc     #>(_player_fire_x)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0031
	inx
	clc
L0031:	adc     #<(_player_fire_dx)
	sta     ptr1
	txa
	adc     #>(_player_fire_dx)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; player_fire_y[i] += player_fire_dy[i];
;
	.dbg	line, "src/dungeon.c", 555
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0032
	inx
	clc
L0032:	adc     #<(_player_fire_y)
	tay
	txa
	adc     #>(_player_fire_y)
	tax
	tya
	sta     ptr2
	stx     ptr2+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	sta     sreg
	stx     sreg+1
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0033
	inx
	clc
L0033:	adc     #<(_player_fire_dy)
	sta     ptr1
	txa
	adc     #>(_player_fire_dy)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	clc
	adc     sreg
	pha
	txa
	adc     sreg+1
	tax
	pla
	sta     (ptr2),y
	iny
	txa
	sta     (ptr2),y
;
; if (player_fire_x[i] < FP(0x10, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 557
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0034
	inx
	clc
L0034:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$04
	bvc     L0009
	eor     #$80
L0009:	bmi     L0045
;
; player_fire_x[i] >= FP(0xf0, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 558
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0035
	inx
	clc
L0035:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$3C
	bvs     L000B
	eor     #$80
L000B:	bmi     L0045
;
; player_fire_y[i] < FP(0x10, 0x00) ||
;
	.dbg	line, "src/dungeon.c", 559
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0036
	inx
	clc
L0036:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$04
	bvc     L000C
	eor     #$80
L000C:	bmi     L0045
;
; player_fire_y[i] >= FP(0xb0, 0x00)) {
;
	.dbg	line, "src/dungeon.c", 560
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0037
	inx
	clc
L0037:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	cmp     #$00
	txa
	sbc     #$2C
	bvs     L000D
	eor     #$80
L000D:	bmi     L0045
	ldx     #$00
	jmp     L0046
;
; player_fire_active[i] = 0;
;
	.dbg	line, "src/dungeon.c", 561
L0045:	ldy     _i
	lda     #$00
	sta     _player_fire_active,y
;
; continue;
;
	.dbg	line, "src/dungeon.c", 562
	jmp     L004D
;
; if (point_room_collision(INT(player_fire_x[i]), INT(player_fire_y[i]))) {
;
	.dbg	line, "src/dungeon.c", 565
L0046:	lda     _i
	asl     a
	bcc     L0038
	inx
	clc
L0038:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	iny
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	jsr     pusha
	ldx     #$00
	lda     _i
	asl     a
	bcc     L0039
	inx
	clc
L0039:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     asrax4
	jsr     asrax2
	jsr     _point_room_collision
	tax
	beq     L0048
;
; player_fire_active[i] = 0;
;
	.dbg	line, "src/dungeon.c", 566
	ldy     _i
	lda     #$00
	sta     _player_fire_active,y
;
; continue;
;
	.dbg	line, "src/dungeon.c", 567
	jmp     L004D
;
; for(temp = 0; temp < num_entities; temp++) {
;
	.dbg	line, "src/dungeon.c", 570
L0048:	sta     _temp
L0049:	lda     _temp
	cmp     _num_entities
	jcs     L004D
;
; if ((entity_lives[temp] > 0) &&
;
	.dbg	line, "src/dungeon.c", 571
	ldy     _temp
	lda     _entity_lives,y
	jeq     L004C
;
; (entity_type[temp] == Patrol) &&
;
	.dbg	line, "src/dungeon.c", 572
	ldy     _temp
	lda     _entity_type,y
	cmp     #$01
	jne     L004C
;
; (entity_x[temp] <= player_fire_x[i]) &&
;
	.dbg	line, "src/dungeon.c", 573
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L003A
	inx
	clc
L003A:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L003B
	inx
	clc
L003B:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	beq     L0042
	jpl     L004C
;
; (player_fire_x[i] < entity_x[temp] + FP(0x10, 0x00)) &&
;
	.dbg	line, "src/dungeon.c", 574
L0042:	ldx     #$00
	lda     _i
	asl     a
	bcc     L003C
	inx
	clc
L003C:	adc     #<(_player_fire_x)
	sta     ptr1
	txa
	adc     #>(_player_fire_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L003D
	inx
	clc
L003D:	adc     #<(_entity_x)
	sta     ptr1
	txa
	adc     #>(_entity_x)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	jpl     L004C
;
; (entity_y[temp] <= player_fire_y[i]) &&
;
	.dbg	line, "src/dungeon.c", 575
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L003E
	inx
	clc
L003E:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _i
	asl     a
	bcc     L003F
	inx
	clc
L003F:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     tosicmp
	beq     L0043
	bpl     L004C
;
; (player_fire_y[i] < entity_y[temp] + FP(0x10, 0x00))) {
;
	.dbg	line, "src/dungeon.c", 576
L0043:	ldx     #$00
	lda     _i
	asl     a
	bcc     L0040
	inx
	clc
L0040:	adc     #<(_player_fire_y)
	sta     ptr1
	txa
	adc     #>(_player_fire_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	jsr     pushax
	ldx     #$00
	lda     _temp
	asl     a
	bcc     L0041
	inx
	clc
L0041:	adc     #<(_entity_y)
	sta     ptr1
	txa
	adc     #>(_entity_y)
	sta     ptr1+1
	ldy     #$01
	lda     (ptr1),y
	tax
	dey
	lda     (ptr1),y
	pha
	txa
	clc
	adc     #$04
	tax
	pla
	jsr     tosicmp
	bpl     L004C
;
; entity_lives[temp]--;
;
	.dbg	line, "src/dungeon.c", 577
	lda     #<(_entity_lives)
	ldx     #>(_entity_lives)
	clc
	adc     _temp
	bcc     L001C
	inx
L001C:	sta     sreg
	stx     sreg+1
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sec
	sbc     #$01
	sta     (sreg),y
;
; player_fire_active[i] = 0;
;
	.dbg	line, "src/dungeon.c", 578
	ldy     _i
	lda     #$00
	sta     _player_fire_active,y
;
; break;
;
	.dbg	line, "src/dungeon.c", 579
	jmp     L004D
;
; for(temp = 0; temp < num_entities; temp++) {
;
	.dbg	line, "src/dungeon.c", 570
L004C:	inc     _temp
	jmp     L0049
;
; for(i = 0; i < MAX_PLAYER_FIRE; i++) {
;
	.dbg	line, "src/dungeon.c", 551
L004D:	inc     _i
	jmp     L0044

	.dbg	line
.endproc

